<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<!--    <title>Title</title>-->
    <style>
        body {
    font-family: -apple-system, system-ui, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial !important;
}

.markdown-body {
    word-break: break-word;
    line-height: 1.75;
    font-weight: 400;
    font-size: 16px;
    overflow-x: hidden;
    color: #333
}

.markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
    line-height: 1.5;
    margin-top: 35px;
    margin-bottom: 10px;
    padding-bottom: 5px
}

.markdown-body h1 {
    font-size: 24px;
    margin-bottom: 5px
}

.markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
    font-size: 20px
}

.markdown-body h2 {
    padding-bottom: 12px;
    border-bottom: 1px solid #ececec
}

.markdown-body h3 {
    font-size: 18px;
    padding-bottom: 0
}

.markdown-body h6 {
    margin-top: 5px
}

.markdown-body p {
    line-height: inherit;
    margin-top: 22px;
    margin-bottom: 22px
}

.markdown-body img {
    max-width: 100%
}

.markdown-body hr {
    border: none;
    border-top: 1px solid #ddd;
    margin-top: 32px;
    margin-bottom: 32px
}

.markdown-body code {
    word-break: break-word;
    border-radius: 2px;
    overflow-x: auto;
    background-color: #fff5f5;
    color: #ff502c;
    font-size: .87em;
    padding: .065em .4em
}

.markdown-body code, .markdown-body pre {
    font-family: Menlo, Monaco, Consolas, Courier New, monospace
}

.markdown-body pre {
    overflow: auto;
    position: relative;
    line-height: 1.75
}

.markdown-body pre > code {
    font-size: 12px;
    padding: 15px 12px;
    margin: 0;
    word-break: normal;
    display: block;
    overflow-x: auto;
    color: #333;
    background: #f8f8f8
}

.markdown-body a {
    text-decoration: none;
    color: #0269c8;
    border-bottom: 1px solid #d1e9ff
}

.markdown-body a:active, .markdown-body a:hover {
    color: #275b8c
}

.markdown-body table {
    display: inline-block !important;
    font-size: 12px;
    width: auto;
    max-width: 100%;
    overflow: auto;
    border: 1px solid #f6f6f6
}

.markdown-body thead {
    background: #f6f6f6;
    color: #000;
    text-align: left
}

.markdown-body tr:nth-child(2n) {
    background-color: #fcfcfc
}

.markdown-body td, .markdown-body th {
    padding: 12px 7px;
    line-height: 24px
}

.markdown-body td {
    min-width: 120px
}

.markdown-body blockquote {
    color: #666;
    padding: 1px 23px;
    margin: 22px 0;
    border-left: 4px solid #cbcbcb;
    background-color: #f8f8f8
}

.markdown-body blockquote:after {
    display: block;
    content: ""
}

.markdown-body blockquote > p {
    margin: 10px 0
}

.markdown-body ol, .markdown-body ul {
    padding-left: 28px
}

.markdown-body ol li, .markdown-body ul li {
    margin-bottom: 0;
    list-style: inherit
}

.markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item {
    list-style: none
}

.markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul {
    margin-top: 0
}

.markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul {
    margin-top: 3px
}

.markdown-body ol li {
    padding-left: 6px
}

.markdown-body .contains-task-list {
    padding-left: 0
}

.markdown-body .task-list-item {
    list-style: none
}

@media (max-width: 720px) {
    .markdown-body h1 {
        font-size: 24px
    }

    .markdown-body h2 {
        font-size: 20px
    }

    .markdown-body h3 {
        font-size: 18px
    }
}
    </style>
</head>
<body>
<div class="markdown-body">
    <h1>ç¬¬ä¸ƒå¤© å¸¸ç”¨è®¾è®¡æ¨¡å¼</h1>
<h2>ç¬¬ä¸€ä¸ªæ•…äº‹ï¼šå›¾ç‰‡é¢„è§ˆ</h2>
<p>å¦‚æœè¯´ç»„ä»¶å°è£…æ˜¯ä¸ºäº†è®©å…¶ä»–ç¨‹åºå‘˜èƒ½å¤Ÿå¤ç”¨å’Œæ‰©å±•æˆ‘ä»¬çš„UIç»„ä»¶ï¼Œé‚£ä¹ˆè®¾è®¡æ¨¡å¼çš„æ„ä¹‰åˆ™åœ¨äºè®©å…¶ä»–ç¨‹åºå‘˜èƒ½å¤Ÿå¤ç”¨æˆ‘ä»¬çš„<strong>è§£å†³æ–¹æ¡ˆ</strong>ã€‚è®¾è®¡æ¨¡å¼ç®€å•æ¥è¯´å°±æ˜¯è§£å†³åœ¨ä¸€ä¸ªç‰¹å®šä¸Šä¸‹æ–‡ä¸­ä¸€ä¸ªé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥ï¼Œä»Šå¤©çš„æ•…äº‹ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠå‰ç«¯å¼€å‘ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<h3>æŠ½è±¡è¡Œä¸ºï¼ˆbehaviorï¼‰</h3>
<p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯è¿™æ ·çš„ï¼Œç»™ä¸€ä¸ªå›ºå®šåˆ—è¡¨ä¸­çš„å›¾ç‰‡å…ƒç´ å¢åŠ â€œé¢„è§ˆâ€åŠŸèƒ½ã€‚</p>
<p>å¯¹åº”çš„HTMLé¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-html"><span class="hljs-meta">&#x3C;!DOCTYPE <span class="hljs-meta-keyword">html</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">head</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">title</span>></span>å›¾ç‰‡é¢„è§ˆ<span class="hljs-tag">&#x3C;/<span class="hljs-name">title</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">style</span>></span><span class="css">
    <span class="hljs-selector-id">#list</span> {
      <span class="hljs-attribute">list-style-type</span>: none;
      <span class="hljs-attribute">justify-content</span>: flex-start;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-wrap</span>: wrap;
    }

    <span class="hljs-selector-id">#list</span> <span class="hljs-selector-tag">li</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-id">#list</span> <span class="hljs-selector-tag">img</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&#x3C;/<span class="hljs-name">style</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">head</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">body</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"list"</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p4.ssl.qhimg.com/t01713d89cfdb45cdf5.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p4.ssl.qhimg.com/t01e456146c8f8a639a.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p1.ssl.qhimg.com/t015f613e2205b573d8.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p0.ssl.qhimg.com/t01290338a28018d404.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p3.ssl.qhimg.com/t01d9aa5ae469c8862e.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p3.ssl.qhimg.com/t01cb20d35fc4aa3c0d.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p5.ssl.qhimg.com/t0110b30256941b9611.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">ul</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">body</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">html</span>></span>
</code></pre>
<p>æ˜¾ç¤ºçš„UIæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="img\9f4bb666-ae6f-11ed-b581-342eb7027b95.jpg" alt=""></p>
<p>è¦å®ç°çš„åŠŸèƒ½æ˜¯ï¼Œé¼ æ ‡ç‚¹å‡»åˆ°åˆ—è¡¨ä¸­çš„å›¾ç‰‡ä¸Šï¼Œæ˜¾ç¤ºå¯¹åº”å›¾ç‰‡ï¼ˆç¼©ç•¥å›¾ï¼‰çš„é«˜æ¸…å¤§å›¾å¹¶å¸¦æœ‰â€œä¸Šä¸€å¼ â€ã€â€œä¸‹ä¸€å¼ â€çš„åˆ‡æ¢æŒ‰é’®ã€‚</p>
<p>è¿™ä¸ªä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆå¾ˆå¤šï¼šä½ å¯ä»¥æŒ‰ç…§å¸¸è§„åšæ³•ï¼Œç»™æ¯å¼ å›¾ç‰‡æ³¨å†Œä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå“åº”ç”¨æˆ·çš„ç‚¹å‡»ï¼Œæ˜¾ç¤ºè¯¥å›¾çš„é¢„è§ˆï¼›ä½ ä¹Ÿå¯ä»¥æŒ‰ç…§ç»„ä»¶å°è£…çš„æ€è·¯ï¼Œè®¾è®¡ä¸€ä¸ªé¢„è§ˆåŠŸèƒ½çš„UIç»„ä»¶ã€‚ä½†æ˜¯ï¼Œä»Šå¤©æˆ‘ä»¬çš„ä¸»é¢˜æ˜¯è®¾è®¡æ¨¡å¼ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨â€œæŠ½è±¡è¡Œä¸ºâ€çš„è®¾è®¡æ¨¡å¼æ¥å®ç°è¿™ä¸ªä»»åŠ¡ã€‚è¿™ç§æ¨¡å¼åº”ç”¨äº†ç¬¬å››æ—¥çš„è¿‡ç¨‹æŠ½è±¡çš„æ€æƒ³ï¼Œæ˜¯æ¯”ç»„ä»¶åŒ–æ›´åŠ è½»é‡çš„ä¸€ç§è§£å†³æ€è·¯ã€‚</p>

<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æŠ½è±¡è¡Œä¸ºæ˜¯å¦‚ä½•å®ç°è¿™ä¸ªé¢„è§ˆè¡Œä¸ºçš„ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> list = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'list'</span>);
list.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =></span> {
  <span class="hljs-keyword">const</span> target = evt.target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.tagName === <span class="hljs-string">'IMG'</span></span>)</span> {
    preview(list, target);
  }
});
</code></pre>
<p>ä¸Šé¢çš„ä»£ç æ˜¯<code>click</code>äº‹ä»¶å¤„ç†å‡½æ•°ã€‚å½“ç‚¹å‡»çš„<code>target</code>æ˜¯å›¾ç‰‡æ—¶ï¼Œåˆ™æ‰§è¡Œ<code>preview(list,target)</code>å‡½æ•°ã€‚è¿™ä¸ª<code>preview</code>å‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„é¢„è§ˆè¡Œä¸ºã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬é‡ç‚¹çœ‹çœ‹<code>preview</code>è¡Œä¸ºæ˜¯å¦‚ä½•è¢«æŠ½è±¡å‡ºæ¥çš„ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useBehavior</span>(<span class="hljs-params">context</span>) </span>{
  <span class="hljs-keyword">const</span> {type, getDetail} = context;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">subject, target</span>) </span>{
    <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> CustomEvent(type, {<span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">detail</span>: getDetail.call(context, subject, target)});
    target.dispatchEvent(event);
  };
}
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¾ˆç®€çŸ­çš„å‡½æ•°<code>useBehavior(context)</code>ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒè¿”å›çš„æ˜¯ä»£è¡¨ç‰¹å®šè¡Œä¸ºçš„æ–¹æ³•ã€‚å½“è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼ å…¥<code>subject</code>å’Œ<code>target</code>ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶é€šè¿‡æ‰§è¡Œ<code>getDetail</code>è·å–åˆ°èµ‹ç»™è¯¥äº‹ä»¶å‚æ•°çš„detailå†…å®¹ï¼Œç„¶åä»¥<code>target</code>ä¸ºç›®æ ‡æ´¾å‘è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å®ƒå®šä¹‰ä¸€ä¸ªå«åšâ€œpreviewâ€çš„è¡Œä¸ºï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> preview = useBehavior({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'preview'</span>,

  <span class="hljs-comment">/*
    @subject: &#x3C;ul>å…ƒç´ 
    @target: é€‰ä¸­çš„å›¾ç‰‡å…ƒç´ 
  */</span>
  <span class="hljs-function"><span class="hljs-title">getDetail</span>(<span class="hljs-params">subject, target</span>)</span> {
    <span class="hljs-keyword">const</span> imgs = <span class="hljs-built_in">Array</span>.from(subject.querySelectorAll(<span class="hljs-string">'img'</span>));
    <span class="hljs-keyword">const</span> selected = imgs.indexOf(target); <span class="hljs-comment">// è·å–é€‰ä¸­å›¾ç‰‡åœ¨å›¾ç‰‡é›†åˆä¸­çš„ç´¢å¼•å·</span>
    <span class="hljs-keyword">let</span> mask = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'mask'</span>);

    <span class="hljs-comment">// å¦‚æœmaskä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªmaskå…ƒç´ </span>
    <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">!mask</span>)</span> {
      mask = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
      mask.id = <span class="hljs-string">'mask'</span>;
      mask.innerHTML = <span class="hljs-string">`
        &#x3C;a class="previous" href="###">&#x26;lt;&#x3C;/a>
        &#x3C;img src="<span class="hljs-subst">${imgs[selected].src}</span>">
        &#x3C;a class="next" href="###">&#x26;gt;&#x3C;/a>    
      `</span>;
      <span class="hljs-comment">// ç»™ #mask å…ƒç´ è®¾ç½®æ ·å¼ï¼š</span>
      <span class="hljs-built_in">Object</span>.assign(mask.style, {
        <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
        <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-string">'100%'</span>,
        <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(0,0,0,0.8)'</span>,
        <span class="hljs-attr">display</span>: <span class="hljs-string">'none'</span>,
        <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
        <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'space-between'</span>,
      });

      <span class="hljs-comment">// ç»™ #mask å…ƒç´ å·¦å³ä¸¤è¾¹çš„&#x3C;a>å…ƒç´ è®¾ç½®æ ·å¼ï¼š</span>
      mask.querySelectorAll(<span class="hljs-string">'a'</span>).forEach(<span class="hljs-function">(<span class="hljs-params">a</span>) =></span> {
        <span class="hljs-built_in">Object</span>.assign(a.style, {
          <span class="hljs-attr">width</span>: <span class="hljs-string">'30px'</span>,
          <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
          <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'2rem'</span>,
          <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span>,
          <span class="hljs-attr">textDecoration</span>: <span class="hljs-string">'none'</span>,
        });
      });
      <span class="hljs-built_in">document</span>.body.appendChild(mask);

      <span class="hljs-comment">// ç»™#maskå…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°ï¼š</span>
      <span class="hljs-keyword">let</span> idx = selected;
      mask.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =></span> {
        <span class="hljs-keyword">const</span> target = evt.target;
        <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target === mask</span>)</span> { <span class="hljs-comment">// å¦‚æœç‚¹å‡»çš„å¯¹è±¡æ˜¯maskå…ƒç´ ï¼Œåˆ™éšè—maskå…ƒç´ </span>
          mask.style.display = <span class="hljs-string">'none'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.className === <span class="hljs-string">'previous'</span></span>)</span> { <span class="hljs-comment">// æ˜¾ç¤ºä¸Šä¸€å¼ å›¾ç‰‡</span>
          update(--idx);
        } <span class="hljs-keyword">else</span> <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.className === <span class="hljs-string">'next'</span></span>)</span> { <span class="hljs-comment">// æ˜¾ç¤ºä¸‹ä¸€å¼ å›¾ç‰‡</span>
          update(++idx);
        }
      });
    }

    <span class="hljs-comment">// è®¾ç½®imgå…ƒç´ çš„srcå±æ€§æŒ‡å‘æŒ‡å®šå›¾ç‰‡</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">idx</span>) </span>{
      <span class="hljs-keyword">const</span> [previous, next] = [...mask.querySelectorAll(<span class="hljs-string">'a'</span>)];
      previous.style.visibility = idx ? <span class="hljs-string">'visible'</span> : <span class="hljs-string">'hidden'</span>;
      next.style.visibility = idx &#x3C; imgs.length - <span class="hljs-number">1</span> ? <span class="hljs-string">'visible'</span> : <span class="hljs-string">'hidden'</span>;
      <span class="hljs-keyword">const</span> img = mask.querySelector(<span class="hljs-string">'img'</span>);
      img.src = imgs[idx].src;
    }

    <span class="hljs-keyword">return</span> {
      <span class="hljs-function"><span class="hljs-title">showMask</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">// æ˜¾ç¤ºé€‰ä¸­å›¾ç‰‡çš„é¢„è§ˆ</span>
        mask.style.display = <span class="hljs-string">'flex'</span>;
        update(selected);
      },
    };
  },
});
</code></pre>
<p>åœ¨<code>getDetail</code>æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª<code>id=mask</code>çš„<code>&#x3C;div></code>å…ƒç´ ï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"mask"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"previous"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"###"</span>></span><span class="hljs-symbol">&#x26;lt;</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"${imgs[selected].src}"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"next"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"###"</span>></span><span class="hljs-symbol">&#x26;gt;</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
</code></pre>
<p>ç„¶åç»™<code>#mask</code>å…ƒç´ è®¾ç½®æ ·å¼ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">Object</span>.assign(mask.style, {
  <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
  <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-string">'100%'</span>,
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(0,0,0,0.8)'</span>,
  <span class="hljs-attr">display</span>: <span class="hljs-string">'flex'</span>,
  <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
  <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'space-between'</span>,
});
mask.querySelectorAll(<span class="hljs-string">'a'</span>).forEach(<span class="hljs-function">(<span class="hljs-params">a</span>) =></span> {
  <span class="hljs-built_in">Object</span>.assign(a.style, {
    <span class="hljs-attr">width</span>: <span class="hljs-string">'30px'</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'2rem'</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span>,
    <span class="hljs-attr">textDecoration</span>: <span class="hljs-string">'none'</span>,
  });
});
<span class="hljs-built_in">document</span>.body.appendChild(mask);
</code></pre>
<p>æ¥ç€æ·»åŠ é¼ æ ‡ç‚¹å‡»<code>mask</code>å…ƒç´ ï¼Œä»¥åŠå·¦å³ä¸¤ä¾§ç®­å¤´ï¼ˆå³<code>a.previous</code>å’Œ<code>a.next</code>ä¸¤ä¸ªå…ƒç´ ï¼‰æ—¶è§¦å‘çš„åŠ¨ä½œï¼š</p>
<pre><code class="hljs language-js">mask.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =></span> {
  <span class="hljs-keyword">const</span> target = evt.target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target === mask</span>)</span> {
    mask.style.display = <span class="hljs-string">'none'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.className === <span class="hljs-string">'previous'</span></span>)</span> {
    update(--idx);
  } <span class="hljs-keyword">else</span> <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.className === <span class="hljs-string">'next'</span></span>)</span> {
    update(++idx);
  }
});
</code></pre>
<p><code>update</code>æ–¹æ³•æ˜¾ç¤º<code>idx</code>å¯¹åº”çš„å›¾ç‰‡ï¼Œä»¥åŠæ ¹æ®å›¾ç‰‡çš„ä½ç½®å†³å®šæ˜¯å¦æ˜¾ç¤ºå·¦å³ç®­å¤´:</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">idx</span>) </span>{
  <span class="hljs-keyword">const</span> [previous, next] = [...mask.querySelectorAll(<span class="hljs-string">'a'</span>)];
  previous.style.visibility = idx ? <span class="hljs-string">'visible'</span> : <span class="hljs-string">'hidden'</span>;
  next.style.visibility = idx &#x3C; imgs.length - <span class="hljs-number">1</span> ? <span class="hljs-string">'visible'</span> : <span class="hljs-string">'hidden'</span>;
  <span class="hljs-keyword">const</span> img = mask.querySelector(<span class="hljs-string">'img'</span>);
  img.src = imgs[idx].src;
}
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ª<code>showMask()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†<code>id=mask</code>çš„<code>&#x3C;div></code>å…ƒç´ çœŸæ­£æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">return</span> {
  <span class="hljs-function"><span class="hljs-title">showMask</span>(<span class="hljs-params"></span>)</span>{
    mask.style.display = <span class="hljs-string">'flex'</span>;
    update(selected);
  },
};
</code></pre>

<p>æ¥ç€æˆ‘ä»¬è¦é€šè¿‡é¼ æ ‡clickäº‹ä»¶è§¦å‘previewè¡Œä¸ºï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> list = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'list'</span>);
list.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =></span> {
  <span class="hljs-keyword">const</span> target = evt.target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.tagName === <span class="hljs-string">'IMG'</span></span>)</span> {
    preview(list, target);
  }
});
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬è®©<code>#list</code>å…ƒç´ ç›‘å¬<code>preview</code>äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-js">list.addEventListener(<span class="hljs-string">'preview'</span>, <span class="hljs-function">(<span class="hljs-params">{detail}</span>) =></span> {
  detail.showMask();
});
</code></pre>
<p>åœ¨<code>preview</code>äº‹ä»¶ç›‘å¬å™¨ä¸­æˆ‘ä»¬æ‰§è¡Œ<code>detail.showMask()</code>ï¼Œå°±èƒ½è§¦å‘å›¾ç‰‡é¢„è§ˆçš„åŠŸèƒ½äº†ã€‚<a href="https://junyux.github.io/FE-Advance/day07/index1.html" target="_blank" rel="nofollow noopener noreferrer">åœ¨çº¿æ¼”ç¤º</a></p>
<p>ä»ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æŠ½è±¡è¡Œä¸ºçš„æ¨¡å¼ï¼Œæˆ‘ä»¬å°†â€œé¢„è§ˆâ€è¿™ä¸ªè¡Œä¸ºä»ç»„ä»¶ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œé™ä½äº†ç»„ä»¶å’Œè¡Œä¸ºçš„è€¦åˆåº¦ã€‚è¿™æ ·åšç©¶ç«Ÿæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>

<h2>ç¬¬äºŒä¸ªæ•…äº‹ï¼šå›¾ç‰‡é€‰æ‹©å™¨</h2>
<p>è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨å’Œç¬¬ä¸€ä¸ªæ•…äº‹ç›¸ä¼¼çš„HTMLç»“æ„ï¼Œå®ç°ä¸€ä¸ªä¸å›¾ç‰‡é¢„è§ˆç±»ä¼¼çš„åŠŸèƒ½ï¼Œå«åšå›¾ç‰‡é€‰æ‹©å™¨ï¼š</p>
<pre><code class="hljs language-html"><span class="hljs-meta">&#x3C;!DOCTYPE <span class="hljs-meta-keyword">html</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">head</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">title</span>></span>æŠ½è±¡è¡Œä¸º<span class="hljs-tag">&#x3C;/<span class="hljs-name">title</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">style</span>></span><span class="css">
    <span class="hljs-selector-id">#list</span> {
      <span class="hljs-attribute">list-style-type</span>: none;
      <span class="hljs-attribute">justify-content</span>: flex-start;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-wrap</span>: wrap;
    }

    <span class="hljs-selector-id">#list</span> <span class="hljs-selector-tag">li</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-id">#list</span> <span class="hljs-selector-tag">img</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">box-sizing</span>: border-box;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;
    }

    <span class="hljs-selector-id">#list</span> <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.selected</span> {
      <span class="hljs-attribute">border</span>: solid <span class="hljs-number">5px</span> <span class="hljs-number">#37c</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
  </span><span class="hljs-tag">&#x3C;/<span class="hljs-name">style</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">head</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">body</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"list"</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p4.ssl.qhimg.com/t01713d89cfdb45cdf5.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p4.ssl.qhimg.com/t01e456146c8f8a639a.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p1.ssl.qhimg.com/t015f613e2205b573d8.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p0.ssl.qhimg.com/t01290338a28018d404.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p3.ssl.qhimg.com/t01d9aa5ae469c8862e.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p3.ssl.qhimg.com/t01cb20d35fc4aa3c0d.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://p5.ssl.qhimg.com/t0110b30256941b9611.jpg"</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">ul</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">body</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">html</span>></span>
</code></pre>
<p>ä¸Šé¢çš„HTMLå’Œå‰é¢çš„å›¾ç‰‡é¢„è§ˆåŸºæœ¬ä¸Šä¸€æ ·ï¼Œåªæ˜¯æœ‰äº›ç»†èŠ‚çš„CSSæ ·å¼ä¿®æ”¹ï¼š</p>
<p><img src="img\9f79d15c-ae6f-11ed-8614-342eb7027b95.jpg" alt=""></p>
<p>æ²¿ç”¨å›¾ç‰‡é¢„è§ˆçš„æ€è·¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å›¾ç‰‡é€‰æ‹©å™¨çš„â€œé€‰æ‹©â€è¡Œä¸ºæŠ½è±¡å‡ºæ¥ï¼Œå®ƒæ¯”å›¾ç‰‡é¢„è§ˆæ›´åŠ ç®€å•ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useBehavior</span>(<span class="hljs-params">context</span>) </span>{
  <span class="hljs-keyword">const</span> {type, getDetail} = context;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">subject, target</span>) </span>{
    <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> CustomEvent(type, {<span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">detail</span>: getDetail.call(context, subject, target)});
    target.dispatchEvent(event);
  }
}

<span class="hljs-keyword">const</span> select = useBehavior({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">picked</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>(), <span class="hljs-comment">// é€‰ä¸­çš„å›¾ç‰‡é›†åˆ</span>
  },
  <span class="hljs-function"><span class="hljs-title">getDetail</span>(<span class="hljs-params">subject, target</span>)</span> {
    <span class="hljs-keyword">const</span> picked = <span class="hljs-built_in">this</span>.data.picked;

    <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">picked.has(target)</span>)</span> {
      target.className = <span class="hljs-string">''</span>;
      picked.delete(target);
    } <span class="hljs-keyword">else</span> {
      target.className = <span class="hljs-string">'selected'</span>;
      picked.add(target);
    }

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">changed</span>: target,
      picked,
    };
  },
});
</code></pre>
<p>åœ¨<code>select</code>è¡Œä¸ºé‡Œï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>picked</code>é›†åˆï¼Œç”¨æ¥å­˜æ”¾æ‰€æœ‰é€‰ä¸­çš„å›¾ç‰‡å…ƒç´ ã€‚<code>getDetail</code>å‡½æ•°ä»…ä»…åšä¸€ä»¶äº‹æƒ…ï¼Œå¦‚æœ<code>target</code>åœ¨<code>picked</code>é›†åˆä¸­ï¼Œå°†å®ƒç§»å‡ºé›†åˆå¹¶æ’¤é”€<code>img</code>å…ƒç´ çš„æ ·å¼ï¼Œå¦åˆ™ï¼Œå°†å®ƒæ”¾å…¥é›†åˆå¹¶æ·»åŠ <code>img</code>å…ƒç´ çš„æ ·å¼ã€‚</p>
<p><em>ğŸ’¡æ³¨æ„ï¼Œåœ¨<code>useBehavior</code>å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å°†<code>context</code>ä½œä¸º<code>getDetail</code>çš„<code>this</code>ä¸Šä¸‹æ–‡ä¼ å…¥ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å®é™…å®ç°<code>getDetail</code>æ–¹æ³•çš„æ—¶å€™ï¼Œé€šè¿‡<code>this</code>ä¸Šä¸‹æ–‡æ‹¿åˆ°è°ƒç”¨<code>useBehavior</code>çš„å¯¹è±¡ä¸Šçš„æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çµæ´»åœ°ç»™<code>getDetail</code>æ“ä½œæä¾›éœ€è¦çš„åˆå§‹æ•°æ®äº†ã€‚</em></p>
<p>ç„¶åï¼Œæˆ‘ä»¬ç»™<code>#list</code>å…ƒç´ æ·»åŠ <code>click</code>å’Œ<code>select</code>äº‹ä»¶å¤„ç†å‡½æ•°ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> list = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'list'</span>);
list.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =></span> {
  <span class="hljs-keyword">const</span> target = evt.target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.tagName === <span class="hljs-string">'IMG'</span></span>)</span> {
    select(list, target);
  }
});

list.addEventListener(<span class="hljs-string">'select'</span>, <span class="hljs-function">(<span class="hljs-params">{detail}</span>) =></span> {
  <span class="hljs-comment">// do nothing</span>
  <span class="hljs-built_in">console</span>.log(detail.changed, detail.picked);
});
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè™½ç„¶ç°åœ¨<code>select</code>äº‹ä»¶å¤„ç†å‡½æ•°ä¸å¤„ç†ä»»ä½•äº‹æƒ…ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥ç›‘å¬å®ƒï¼Œä»¥ä¾¿å°†æ¥å¯¹é€‰æ‹©çš„å¯¹è±¡è¿›è¡Œä¸‹ä¸€æ­¥åŠ¨ä½œã€‚å®ƒçš„æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><a href="https://junyux.github.io/FE-Advance/day07/index2.html" target="_blank" rel="nofollow noopener noreferrer">åœ¨çº¿æ¼”ç¤º</a></p>
<p><img src="img\9f95fd73-ae6f-11ed-83f7-342eb7027b95.jpg" alt=""></p>
<p>é€šè¿‡ç¬¬ä¸€ä¸ªæ•…äº‹å’Œç¬¬äºŒä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠâ€œé¢„è§ˆâ€å’Œâ€œé€‰æ‹©â€è¿™ä¸¤ä¸ªè¡Œä¸ºç»„åˆèµ·æ¥ã€‚æ¯”å¦‚ï¼Œå½“é¼ æ ‡ç‚¹å‡»çš„åŒæ—¶ï¼Œæˆ‘ä»¬æŒ‰ä¸‹altå»ºï¼Œå°±è¡¨ç¤ºé€‰æ‹©å›¾ç‰‡ï¼›å¦åˆ™å°±æ˜¯é¢„è§ˆå›¾ç‰‡ï¼š</p>

<p><a href="https://junyux.github.io/FE-Advance/day07/index3.html" target="_blank" rel="nofollow noopener noreferrer">åœ¨çº¿æ¼”ç¤º</a></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* ...çœç•¥å…¶ä»–ä»£ç ... */</span>

<span class="hljs-keyword">const</span> list = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'list'</span>);
list.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">evt</span>) =></span> {
  <span class="hljs-keyword">const</span> target = evt.target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">target.tagName === <span class="hljs-string">'IMG'</span></span>)</span> {
    <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">evt.altKey</span>)</span> {
      select(list, target);
    } <span class="hljs-keyword">else</span> {
      preview(list, target);
    }
  }
});

list.addEventListener(<span class="hljs-string">'preview'</span>, <span class="hljs-function">(<span class="hljs-params">{detail}</span>) =></span> {
  <span class="hljs-keyword">const</span> {showMask} = detail;
  showMask();
});
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼ŒæŠ½è±¡è¡Œä¸ºçš„æ¨¡å¼å…è®¸ä¸€ä¸ªç»„ä»¶å¯ä»¥çµæ´»çš„<strong>ç»„åˆæˆ–å¸è½½</strong>å¤šä¸ªè¡Œä¸ºï¼Œä¸”äº’ä¸å†²çªã€‚</p>


<p>ä½†æ˜¯ï¼Œä¸Šé¢çš„ä¾‹å­åªæ˜¯éå¸¸ç²—ç•¥çš„æŠ½è±¡æ–¹å¼ï¼Œè€Œä¸”è¿˜æœ‰ä¸€äº›äº‰è®®ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å°†é¢„è§ˆè¡Œä¸ºä¸­çš„<code>showMask</code>æ“ä½œç›´æ¥æ”¾åœ¨<code>getDetail</code>é‡Œé¢å®Œæˆï¼Œä¸ºä»€ä¹ˆè¦å°†å®ƒæš´éœ²ç»™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œåœ¨å¤„ç†å‡½æ•°ä¸­æ‰‹å·¥è°ƒç”¨ï¼Ÿå¦å¤–ï¼Œ<code>select</code>è¡Œä¸ºä¸­ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆåˆå°†<code>className</code>çš„å˜åŒ–æ”¾åœ¨<code>getDetail</code>é‡Œé¢è€Œä¸æ˜¯å°†å®ƒäº¤ç»™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Ÿ</p>
<p>è¿™é‡Œæ˜¯æœ‰å¯æƒè¡¡çš„åœ°æ–¹ï¼Œå®é™…ä¸ŠæŠŠæ“ä½œæ”¾åœ¨å“ªè¾¹ï¼Œéƒ½å„æœ‰åˆ©å¼Šã€‚ä¸è¿‡æˆ‘ä»¬ä¸€èˆ¬éµå¾ªä¸€ä¸ªå¤§çš„åŸåˆ™â€”â€”å¦‚æœæ“ä½œåªæ˜¯å¤„ç†æ•°æ®æˆ–æ”¹å˜çŠ¶æ€ï¼Œé‚£ä¹ˆå°†å®ƒæ”¾åœ¨<code>getDetail</code>ä¸­ï¼›ä½†æ˜¯å¦‚æœåŒæ—¶æ”¹å˜äº†DOMç»“æ„ï¼Œæ¯”å¦‚åˆ›å»ºæˆ–åˆ é™¤äº†å…ƒç´ ï¼Œé‚£ä¹ˆè¿™äº›æ“ä½œæˆ‘ä»¬å¯ä»¥äº¤ç»™äº‹ä»¶å¤„ç†å‡½æ•°å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>getDetail</code>å‡½æ•°åªå¤„ç†æ•°æ®æˆ–è€…æ”¹å˜å…ƒç´ çš„<code>className</code>ï¼ˆå³çŠ¶æ€ï¼‰ï¼Œä¸å¯¹DOMæ ‘çš„ç»“æ„åšä¿®æ”¹ã€‚å› ä¸ºè¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç»„åˆå¤šä¸ªè¡Œä¸ºä¸‹ï¼ŒDOMç»“æ„çš„ç¨³å®šï¼Œå¦åˆ™ä¸€ä¸ªè¡Œä¸ºæ“ä½œçš„DOMå…ƒç´ è¢«å¦ä¸€ä¸ªè¡Œä¸ºåˆ é™¤å°±ä¼šå¯¼è‡´å†²çªã€‚</p>

<p>æŠ½è±¡è¡Œä¸ºï¼ˆbehaviorï¼‰æ¨¡å¼è¿˜æœ‰å¾ˆå¤šç”¨é€”ï¼Œå¯ä»¥åˆ›é€ éå¸¸å¤æ‚çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å°†ä¼šåœ¨è®¾è®¡æ¨¡å¼çš„è¯¾ç¨‹ä¸­è¯¦ç»†ä»‹ç»ã€‚ä¸‹ä¸€ä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬æ¥çœ‹å¦ä¸€ä¸ªå‰ç«¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ â€”â€” ä¸­é—´äººæ¨¡å¼ã€‚</p>
<h2>ç¬¬ä¸‰ä¸ªæ•…äº‹ï¼šæ»šåŠ¨çš„æ–‡å­—</h2>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ–°ä»»åŠ¡æ˜¯å®ç°ä¸€ä¸ªåŒæ­¥æ»šåŠ¨çš„ç¼–è¾‘ä¸é¢„è§ˆåŒºï¼Œè¿™æ˜¯ä¸€äº›åœ¨çº¿ç¼–è¾‘ç±»Webåº”ç”¨å¸¸è§çš„ä¸€ç§äº¤äº’å½¢å¼ã€‚</p>
<p><img src="img\a023a33f-ae6f-11ed-8f60-342eb7027b95.jpg" alt=""></p>
<p><em>åŒæ­¥æ»šåŠ¨çš„ç¼–è¾‘ä¸é¢„è§ˆåŒº</em></p>
<p>è¿™æ˜¯é¡µé¢çš„HTMLç»“æ„ï¼š</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">body</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"editor"</span> <span class="hljs-attr">oninput</span>=<span class="hljs-string">"this.editor.update()"</span>
            <span class="hljs-attr">rows</span>=<span class="hljs-string">"6"</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">"60"</span>></span>
åœ¨ 2001 åˆ° 2003 å¹´é—´ï¼ŒJudith Miller åœ¨çº½çº¦æ—¶æŠ¥ä¸Šå‘è¡¨äº†ä¸€æ‰¹æ–‡ç« ï¼Œå®£ç§°ä¼Šæ‹‰å…‹æœ‰èƒ½åŠ›å’Œé‡å¿ƒç”Ÿäº§å¤§è§„æ¨¡æ€ä¼¤æ€§æ­¦å™¨ã€‚è¿™æ˜¯å‡æ–°é—»ã€‚

å›é¡¾å½“å¹´ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®š Miller å†™çš„è¿™äº›æ•…äº‹åœ¨ç¾å›½ 2013 å¹´åšå‡ºå‘åŠ¨ä¼Šæ‹‰å…‹æˆ˜äº‰çš„å†³å®šä¸­æ‰®æ¼”äº†æ€æ ·çš„è§’è‰²ï¼›ä¸ Miller ç›¸åŒæ¥æºçš„æ¶ˆæ¯ä¸å°å¸ƒä»€æ”¿åºœçš„å¯¹å¤–æ”¿ç­–å›¢é˜Ÿæœ‰å¾ˆå¤§å…³è”ã€‚ä½†æ˜¯ï¼Œçº½çº¦æ—¶æŠ¥ä»ç„¶èµ·åˆ°äº†ä¸ºè¿™ä¸€æ”¿ç­–èƒŒä¹¦çš„ä½œç”¨ï¼Œå°¤å…¶æ˜¯å¯¹æ°‘ä¸»å…šäººï¼Œæœ¬æ¥ä»–ä»¬åº”è¯¥ä¼šæ›´åšå®šåœ°åå¯¹å°å¸ƒä»€çš„æ”¿ç­–ã€‚æ¯•ç«Ÿï¼Œçº½çº¦æ—¶æŠ¥å¯ä¸æ˜¯ä¸€äº›æ— äººé—®æ´¥çš„åœ°æ–¹å°æŠ¥ï¼Œå®ƒæ˜¯æ•´ä¸ªç¾å›½å½±å“åŠ›æœ€å¤§çš„æŠ¥åˆŠï¼Œå®ƒä¸€èˆ¬è¢«è®¤ä¸ºå…·æœ‰å·¦å€¾å€¾å‘ã€‚Miller çš„æ•…äº‹æŸç§ç¨‹åº¦ä¸Šå»åˆæŠ¥çº¸çš„æ”¿æ²»å€¾å‘ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠ Miller çš„é”™è¯¯å’Œæœ€è¿‘å…³äº Facebook çš„å‡æ–°é—»é—®é¢˜è”ç³»èµ·æ¥çœ‹ï¼›Facebook ç”¨è‡ªå·±çš„æ•…äº‹å‘Šè¯«æˆ‘ä»¬â€œå‡æ–°é—»æ˜¯åçš„â€ã€‚ç„¶è€Œï¼Œæˆ‘æŒæœ‰ä¸åŒçš„è§‚ç‚¹ï¼š**æ–°é—»å‡ä¸å‡æ²¡é‚£ä¹ˆé‡è¦ï¼Œç”±è°æ¥å†³å®šä»€ä¹ˆæ˜¯æ–°é—»æ‰æ˜¯ç¬¬ä¸€é‡è¦çš„**ã€‚

<span class="hljs-comment">&#x3C;!--more--></span>

#### Facebook çš„åª’ä½“å•†ä¸šåŒ–

åœ¨[èšé›†ç†è®º](https://stratechery.com/2015/aggregation-theory/)ä¸­ï¼Œæˆ‘æè¿°äº†åŸºäºåˆ†é…çš„ç»æµæƒåˆ©çš„æ¶ˆäº¡å¯¼è‡´å¼ºåŠ¿ä¸­ä»‹çš„å´›èµ·ï¼Œå®ƒä»¬æŒæ§å®¢æˆ·ä½“éªŒå¹¶å°†å®ƒä»¬çš„ä¾›åº”å•†å•†å“åŒ–ã€‚[åœ¨ Facebook çš„ä¾‹å­é‡Œ](https://stratechery.com/2016/the-fang-playbook/)ï¼Œç¤¾äº¤ç½‘ç»œä¹‹æ‰€ä»¥å…´èµ·ï¼Œæ˜¯å› ä¸ºä¹‹å‰å­˜åœ¨çš„çº¿ä¸‹ç¤¾ä¼šç½‘ç»œåœ¨å¾€çº¿ä¸Šç½‘ç»œè½¬å˜ã€‚è€ƒè™‘åˆ°äººç±»æœ¬è´¨æ˜¯ç¤¾ä¼šåŒ–çš„ï¼Œç”¨æˆ·å¼€å§‹å°†æ—¶é—´èŠ±åœ¨ Facebook ä¸Šé˜…è¯»ã€å‘è¡¨è§‚ç‚¹å’Œè·å–æ–°é—»ã€‚

...ï¼ˆæ­¤å¤„çœç•¥ï¼‰
                     
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">textarea</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"preview"</span>></span> <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hintbar"</span>></span> 0% <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">body</span>></span>
</code></pre>
<p>CSSæ ·å¼ï¼š</p>
<pre><code class="hljs language-css"><span class="hljs-selector-tag">body</span>{
  <span class="hljs-attribute">display</span>: flex;
}

<span class="hljs-selector-id">#editor</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">45%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">350px</span>;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-id">#preview</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">45%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">350px</span>;
  <span class="hljs-attribute">overflow</span>: scroll;
}

<span class="hljs-selector-id">#hintbar</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>;
}
</code></pre>
<p>è¦å®ç°è¿™ä¸ªæ•ˆæœï¼Œè¦æ§åˆ¶3ä¸ªåŒºåŸŸçš„çŠ¶æ€ï¼Œå·¦ä¾§çš„ç¼–è¾‘åŒºï¼Œè¿™æ˜¯ä¸€ä¸ª<code>textare</code>å…ƒç´ å’Œå…¶ä¸­çš„æ–‡æœ¬ï¼Œä¸­é—´çš„é¢„è§ˆåŒºï¼Œè¿™æ˜¯ä¸€ä¸ª<code>id</code>ä¸º<code>preview</code>çš„<code>div</code>å…ƒç´ ï¼Œå³ä¾§æ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ª<code>id</code>ä¸º<code>hintbar</code>çš„<code>div</code>å…ƒç´ ã€‚</p>
<p>æœ€ç®€å•çš„æ€è·¯æ˜¯æˆ‘ä»¬åŒæ­¥è¿™ä¸‰ä¸ªåŒºåŸŸçš„çŠ¶æ€ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®ç°ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨markdownçš„JSåº“æä¾›æ¥å£ï¼Œåˆ›å»ºä¸€ä¸ª<code>Editor</code>çš„å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Editor</span>(<span class="hljs-params">input, preview</span>) </span>{
  <span class="hljs-built_in">this</span>.update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    preview.innerHTML = markdown.toHTML(input.value);
  };
  input.editor = <span class="hljs-built_in">this</span>;
  <span class="hljs-built_in">this</span>.update();
}
<span class="hljs-keyword">new</span> Editor(editor, preview);
</code></pre>
<p>ä¸Šé¢çš„ä»£ç æŠŠ<code>editor</code>ä¸­çš„å†…å®¹ç»è¿‡markdownè§£æåèµ‹ç»™<code>preview</code>å…ƒç´ ã€‚</p>
<p>è€Œmarkdownåº“å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åŠ è½½åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸­ï¼š</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://s3.ssl.qhres.com/!67fc024a/markdown.min.js"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span>
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬æ¥å®ç°ä¸‰éƒ¨åˆ†åŒæ­¥çš„åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-comment">//ä¸‰éƒ¨åˆ† UI è€¦åˆåœ¨ä¸€èµ·çš„ update æ–¹æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">src, dest, hint</span>) </span>{
  <span class="hljs-keyword">var</span> scrollRange = src.scrollHeight - src.clientHeight,
      p = src.scrollTop / scrollRange;  
  
  dest.scrollTop = p * (dest.scrollHeight - dest.clientHeight);
  hint.innerHTML = <span class="hljs-built_in">Math</span>.round(<span class="hljs-number">100</span> * p) + <span class="hljs-string">'%'</span>;
}

update(editor, preview, hintbar);
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œ<code>update</code>æ–¹æ³•è¯»å–æ»šåŠ¨å…ƒç´ ï¼ˆ<code>src</code>ï¼‰çš„æ»šåŠ¨ä½ç½®ï¼Œæ¢ç®—æˆç™¾åˆ†æ¯”ï¼Œç„¶åå°†è¢«åŒæ­¥çš„ç›®æ ‡å…ƒç´ ï¼ˆ<code>dest</code>ï¼‰çš„<code>scrollTop</code>å±æ€§è®¾ç½®ä¸ºå’Œè¿™ä¸ªç™¾åˆ†æ¯”å€¼å¯¹åº”çš„æ»šåŠ¨ä½ç½®ã€‚æœ€åï¼Œå°†è¿™ä¸ªç™¾åˆ†æ¯”å€¼èµ‹ç»™<code>hint</code>å…ƒç´ ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åˆ†åˆ«ç»™<code>editor</code>å’Œ<code>preview</code>å…ƒç´ æ·»åŠ <code>scroll</code>äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-js">editor.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
  update(editor, preview, hintbar);
});

preview.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{  
  update(preview, editor, hintbar);
});
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥å®ç°æ»šåŠ¨åŒæ­¥äº†ã€‚ä½†æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å…¶å®å­˜åœ¨é”™è¯¯ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç°åœ¨çš„æ•ˆæœï¼š</p>
<p><img src="img\a0949a72-ae6f-11ed-8f8e-342eb7027b95.jpg" alt=""></p>
<p>ä½ ä¼šçœ‹åˆ°ï¼Œä¸€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ»šåŠ¨å·¦ä¾§ï¼Œå³ä¾§è·Ÿç€æ»šåŠ¨æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“æˆ‘ä»¬åœæ­¢æ»šåŠ¨çš„æ—¶å€™ï¼Œé¡µé¢ç«Ÿç„¶è‡ªå·±ä¼šæ…¢æ…¢åœ°å¾€ä¸Šæ»šåŠ¨å›å»ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯å‘¢ï¼Ÿå…¶å®é—®é¢˜å‡ºç°åœ¨<code>update</code>æ–¹æ³•ä¸Šï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">src, dest, hint</span>) </span>{
  <span class="hljs-keyword">var</span> scrollRange = src.scrollHeight - src.clientHeight,
      p = src.scrollTop / scrollRange;  
  
  dest.scrollTop = p * (dest.scrollHeight - dest.clientHeight);
  hint.innerHTML = <span class="hljs-built_in">Math</span>.round(<span class="hljs-number">100</span> * p) + <span class="hljs-string">'%'</span>;
}
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•æ›´æ–°äº†<code>dest</code>çš„<code>scrollTop</code>ã€‚è°ƒç”¨<code>update(editor, preview, hintbar)</code>ï¼Œå°±æ˜¯ç”¨<code>editor</code>çš„æ»šåŠ¨ä¿¡æ¯å»æ›´æ–°<code>preview</code>çš„<code>scrollTop</code>ã€‚ä½†æ˜¯ï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå¦‚æœå…ƒç´ çš„<code>scrollTop</code>æ”¹å˜ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘<code>scroll</code>äº‹ä»¶ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬ç›‘å¬<code>editor</code>çš„<code>scroll</code>äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-js">editor.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
  update(editor, preview, hintbar);
});
</code></pre>
<p>åœ¨è¿™ä¸ª<code>scroll</code>äº‹ä»¶é‡Œæˆ‘ä»¬è°ƒç”¨<code>update(editor, preview, hintbar)</code>ï¼Œæ”¹å˜äº†<code>perview</code>çš„<code>scrollTop</code>ï¼Œè¿™æ—¶å°±ä¼šè§¦å‘<code>preview</code>çš„<code>scroll</code>äº‹ä»¶ï¼Œä½†æˆ‘ä»¬åˆåŒæ—¶ç›‘å¬äº†<code>preview</code>çš„<code>scroll</code>äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-js">preview.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
  update(preview, editor, hintbar);
});
</code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬åˆæ‰§è¡Œäº†ä¸€æ¬¡<code>update(preview, editor, hintbar)</code>ï¼Œè€Œåœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä»¬åˆåè¿‡æ¥æ›´æ–°äº†<code>editor</code>çš„<code>scrollTop</code>ï¼Œäºæ˜¯åˆè§¦å‘äº†<code>editor</code>çš„<code>scroll</code>äº‹ä»¶ï¼Œè¿™æ ·æ¥å›åå¤è§¦å‘ï¼Œæ ¹æœ¬åœä¸ä¸‹æ¥â€¦â€¦</p>
<p>æ‰€ä»¥ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ï¼Œå½“<code>preview</code>çš„<code>scroll</code>äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä¸åº”è¯¥é©¬ä¸Šè§¦å‘<code>editor</code>çš„<code>scroll</code>äº‹ä»¶ã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥ä¸­ç”¨å‰é¢å­¦è¿‡çš„<code>debounce</code>å‡½æ•°æ¥è§£å†³ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, ms = <span class="hljs-number">100</span></span>) </span>{
  <span class="hljs-keyword">let</span> debounceTimer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>{
    <span class="hljs-keyword">if</span>(debounceTimer) <span class="hljs-built_in">clearTimeout</span>(debounceTimer);

    debounceTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
      fn.apply(<span class="hljs-built_in">this</span>, args);
    }, ms);
  }
}

<span class="hljs-keyword">let</span> scrollingTarget = <span class="hljs-literal">null</span>;
editor.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{
  <span class="hljs-keyword">if</span>(!scrollingTarget) scrollingTarget = editor;
  <span class="hljs-keyword">if</span>(scrollingTarget === editor) update(editor, preview, hintbar);
});

editor.addEventListener(<span class="hljs-string">'scroll'</span>, debounce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{
  scrollingTarget = <span class="hljs-literal">null</span>;
}));

preview.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{  
  <span class="hljs-keyword">if</span>(!scrollingTarget) scrollingTarget = preview;
  <span class="hljs-keyword">if</span>(scrollingTarget === preview) update(preview, editor, hintbar);
});
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>scrollingTarge</code>tå¯¹è±¡ï¼Œå½“å®ƒä¸º<code>null</code>æ—¶ï¼Œ<code>editor</code>æˆ–<code>preview</code>å“ªä¸€è¾¹çš„scrollå…ˆè§¦å‘ï¼Œæˆ‘ä»¬å°±æŠŠ<code>scrollingTarget</code>è®¾ä¸ºå¯¹åº”çš„å¯¹è±¡ã€‚æˆ‘ä»¬è®¾å®šå½“scrolläº‹ä»¶è§¦å‘æ—¶ï¼Œ<code>scrollingTarget</code>ä¸å¯¹åº”çš„å¯¹è±¡ç›¸åŒæ—¶æ‰ä¼šæ‰§è¡Œ<code>update</code>ã€‚è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬å…ˆæ»šåŠ¨<code>editor</code>ï¼Œé‚£ä¹ˆ<code>scrollingTarget</code>çš„å€¼è¢«è®¾ä¸º<code>editor</code>,è¿™æ ·å°±åªæœ‰<code>editor</code>çš„æ»šåŠ¨äº‹ä»¶ä¸­ï¼Œ<code>update</code>æ‰ä¼šè¢«è§¦å‘ã€‚</p>
<p>ç›´åˆ°<code>editor</code>æ»šåŠ¨ç»“æŸï¼Œæˆ‘ä»¬å†å°†<code>scrollingTarget</code>é‡æ–°è®¾ä¸ºnullï¼š</p>
<pre><code class="hljs language-js">editor.addEventListener(<span class="hljs-string">'scroll'</span>, debounce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{
  scrollingTarget = <span class="hljs-literal">null</span>;
}));

<span class="hljs-comment">/* æˆ–è€…
preview.addEventListener('scroll', debounce(function(evt){
  scrollingTarget = null;
}));
*/</span>
</code></pre>
<p>æ³¨æ„ï¼Œå› ä¸ºä¸è®ºå“ªä¸€è¾¹è°ƒç”¨<code>update</code>ï¼Œéƒ½ä¼šè§¦å‘å¦ä¸€è¾¹çš„scrolläº‹ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªè¦<code>editor</code>æˆ–<code>preivew</code>ä»»æ„ä¸€è¾¹æ³¨å†Œäº†è¿™ä¸ª<code>debounce</code>å˜æ¢åçš„å‡½æ•°å³å¯ï¼Œä¸éœ€è¦ä¸¤è¾¹éƒ½æ³¨å†Œã€‚è¿™æ ·æˆ‘ä»¬å°±æ­£å¸¸å®ç°äº†æ»šåŠ¨æ–‡å­—çš„åŠŸèƒ½äº†ã€‚<a href="https://junyux.github.io/FE-Advance/day07/index4-v1.html" target="_blank" rel="nofollow noopener noreferrer">åœ¨çº¿æ¼”ç¤º</a></p>
<p>ä½†æ˜¯ï¼Œä¸Šè¿°çš„å®ç°æ–¹å¼æœ‰æ˜æ˜¾çš„ç¼ºç‚¹ï¼šå°†ä¸‰ä¸ªUIå…ƒç´ çš„çŠ¶æ€åŒæ­¥è€¦åˆåœ¨ä¸€ä¸ª<code>update</code>å‡½æ•°é‡Œå¤„ç†ï¼Œå¯¼è‡´è¿™ä¸ªæ–¹æ³•ä¸é€šç”¨ã€‚å‡è®¾æˆ‘ä»¬è¦å¢åŠ ä¸€ä¸ªåŒæ­¥çŠ¶æ€çš„å¯¹è±¡æˆ–è€…å‡å°‘ä¸€ä¸ªåŒæ­¥çŠ¶æ€çš„å¯¹è±¡ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¿®æ”¹<code>update</code>çš„ä»£ç ï¼Œè€Œä¸”å°†æ¥è¦ç»„åˆä¸åŒçš„æ“ä½œæ”¹å˜çŠ¶æ€ä¹Ÿä¼šéå¸¸éº»çƒ¦ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œé™ä½è¿™ç§åŒæ­¥çŠ¶æ€çš„è€¦åˆåº¦ï¼Œä½¿å¾—çŠ¶æ€åŒæ­¥çš„åŠŸèƒ½æ˜“äºç»´æŠ¤ã€‚</p>

<p><strong>ä¸­é—´äººï¼ˆMediatorï¼‰</strong></p>
<p>ä¸€ä¸ªæœ€ç®€å•çš„<code>Mediator</code>æ¨¡å¼çš„ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PubSub</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">this</span>.subscribers = {};
  }

  <span class="hljs-comment">/*
    @type æ¶ˆæ¯ç±»å‹ï¼Œå¦‚scroll
    @receiver è®¢é˜…è€…
    @fn å“åº”æ¶ˆæ¯çš„å¤„ç†å‡½æ•°
  */</span>
  <span class="hljs-function"><span class="hljs-title">sub</span>(<span class="hljs-params">type, receiver, fn</span>)</span> {
    <span class="hljs-built_in">this</span>.subscribers[type] = <span class="hljs-built_in">this</span>.subscribers[type] || [];
    <span class="hljs-built_in">this</span>.subscribers[type].push(fn.bind(receiver));
  }

  <span class="hljs-comment">/*
    @type æ¶ˆæ¯ç±»å‹
    @sender æ´¾å‘æ¶ˆæ¯è€…
    @data æ•°æ®ï¼Œæ¯”å¦‚çŠ¶æ€æ•°æ®
  */</span>
  <span class="hljs-function"><span class="hljs-title">pub</span>(<span class="hljs-params">type, sender, data</span>)</span> {
    <span class="hljs-keyword">const</span> subscribers = <span class="hljs-built_in">this</span>.subscribers[type];
    subscribers.forEach(<span class="hljs-function">(<span class="hljs-params">subscriber</span>) =></span> {
      subscriber({type, sender, data});
    });
  }
}
</code></pre>
<p><code>PubSub</code>ç±»å®šä¹‰äº†ä¸€ä¸ªä¸­é—´äººçš„è¡Œä¸ºã€‚<code>sub</code>æ–¹æ³•æ”¶é›†è®¢é˜…è€…çš„å…³äº<code>type</code>ç±»å‹çš„å“åº”è¡Œä¸ºã€‚<code>pub</code>æ–¹æ³•å°†<code>type</code>ç±»å‹çš„æ¶ˆæ¯æ´¾å‘ç»™æ‰€æœ‰æ³¨å†Œäº†è¯¥ç±»å‹æ¶ˆæ¯çš„è®¢é˜…è€…ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬è®©<code>preview</code>ã€<code>editor</code>ã€<code>hintbar</code>å…ƒç´ åˆ†åˆ«ç›‘å¬<code>scroll</code>ç±»å‹çš„æ¶ˆæ¯ã€‚</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scrollTo</span>(<span class="hljs-params">{data:p}</span>)</span>{
  <span class="hljs-built_in">this</span>.scrollTop = p * (<span class="hljs-built_in">this</span>.scrollHeight - <span class="hljs-built_in">this</span>.clientHeight);
}

<span class="hljs-keyword">var</span> mediator = <span class="hljs-keyword">new</span> PubSub();
mediator.sub(<span class="hljs-string">'scroll'</span>, preview, scrollTo);
mediator.sub(<span class="hljs-string">'scroll'</span>, editor, scrollTo);
mediator.sub(<span class="hljs-string">'scroll'</span>, hintbar, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">{data:p}</span>)</span>{
  <span class="hljs-built_in">this</span>.innerHTML = <span class="hljs-built_in">Math</span>.round(p * <span class="hljs-number">100</span>) + <span class="hljs-string">'%'</span>;
});
</code></pre>
<p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨<code>editor</code>å’Œ<code>preview</code>å…ƒç´ æ»šåŠ¨çš„æ—¶å€™ï¼Œè®©ä¸­é—´äººæ´¾å‘æ¶ˆæ¯ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, ms = <span class="hljs-number">100</span></span>) </span>{
  <span class="hljs-keyword">let</span> debounceTimer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>{
    <span class="hljs-keyword">if</span>(debounceTimer) <span class="hljs-built_in">clearTimeout</span>(debounceTimer);

    debounceTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
      fn.apply(<span class="hljs-built_in">this</span>, args);
    }, ms);
  }
}

<span class="hljs-keyword">let</span> scrollingTarget = <span class="hljs-literal">null</span>;
editor.addEventListener(<span class="hljs-string">'scroll'</span>, debounce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{
  scrollingTarget = <span class="hljs-literal">null</span>;
}));

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateScroll</span>(<span class="hljs-params">evt</span>) </span>{
  <span class="hljs-keyword">var</span> target = evt.target;
  <span class="hljs-keyword">if</span>(!scrollingTarget) scrollingTarget = target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">scrollingTarget === target</span>)</span> {
    <span class="hljs-keyword">var</span> scrollRange = target.scrollHeight - target.clientHeight,
      p = target.scrollTop / scrollRange;

    <span class="hljs-comment">// ä¸­é—´äººæ´¾å‘scrollæ¶ˆæ¯</span>
    mediator.pub(<span class="hljs-string">'scroll'</span>, target, p);
  }
}
editor.addEventListener(<span class="hljs-string">'scroll'</span>, updateScroll);
preview.addEventListener(<span class="hljs-string">'scroll'</span>, updateScroll);
</code></pre>
<p>æ³¨æ„è¿™é‡Œä¸€æ ·è¦ä½¿ç”¨debounceã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†åŒæ ·çš„åŒæ­¥æ»šåŠ¨ï¼Œå®Œæ•´çš„JavaScriptä»£ç å¦‚ä¸‹ï¼š</p>
<p><a href="https://junyux.github.io/FE-Advance/day07/index4-v2.html" target="_blank" rel="nofollow noopener noreferrer">åœ¨çº¿æ¼”ç¤º</a></p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Editor</span>(<span class="hljs-params">input, preview</span>) </span>{
  <span class="hljs-built_in">this</span>.update = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    preview.innerHTML = markdown.toHTML(input.value);
  };
  input.editor = <span class="hljs-built_in">this</span>;
  <span class="hljs-built_in">this</span>.update();
}
<span class="hljs-keyword">new</span> Editor(editor, preview);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PubSub</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">this</span>.subscribers = {};
  }
  <span class="hljs-function"><span class="hljs-title">pub</span>(<span class="hljs-params">type, sender, data</span>)</span>{
    <span class="hljs-keyword">var</span> subscribers = <span class="hljs-built_in">this</span>.subscribers[type];
    subscribers.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">subscriber</span>)</span>{
      subscriber({type, sender, data});
    });
  }
  <span class="hljs-function"><span class="hljs-title">sub</span>(<span class="hljs-params">type, receiver, fn</span>)</span>{
    <span class="hljs-built_in">this</span>.subscribers[type] = <span class="hljs-built_in">this</span>.subscribers[type] || [];
    <span class="hljs-built_in">this</span>.subscribers[type].push(fn.bind(receiver));
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scrollTo</span>(<span class="hljs-params">{data:p}</span>)</span>{
  <span class="hljs-built_in">this</span>.scrollTop = p * (<span class="hljs-built_in">this</span>.scrollHeight - <span class="hljs-built_in">this</span>.clientHeight);
}

<span class="hljs-keyword">var</span> mediator = <span class="hljs-keyword">new</span> PubSub();
mediator.sub(<span class="hljs-string">'scroll'</span>, preview, scrollTo);
mediator.sub(<span class="hljs-string">'scroll'</span>, editor, scrollTo);
mediator.sub(<span class="hljs-string">'scroll'</span>, hintbar, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">{data:p}</span>)</span>{
  <span class="hljs-built_in">this</span>.innerHTML = <span class="hljs-built_in">Math</span>.round(p * <span class="hljs-number">100</span>) + <span class="hljs-string">'%'</span>;
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, ms = <span class="hljs-number">100</span></span>) </span>{
  <span class="hljs-keyword">let</span> debounceTimer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>{
    <span class="hljs-keyword">if</span>(debounceTimer) <span class="hljs-built_in">clearTimeout</span>(debounceTimer);

    debounceTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
      fn.apply(<span class="hljs-built_in">this</span>, args);
    }, ms);
  }
}

<span class="hljs-keyword">let</span> scrollingTarget = <span class="hljs-literal">null</span>;
editor.addEventListener(<span class="hljs-string">'scroll'</span>, debounce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{
  scrollingTarget = <span class="hljs-literal">null</span>;
}));

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateScroll</span>(<span class="hljs-params">evt</span>) </span>{
  <span class="hljs-keyword">var</span> target = evt.target;
  <span class="hljs-keyword">if</span>(!scrollingTarget) scrollingTarget = target;
  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">scrollingTarget === target</span>)</span> {
    <span class="hljs-keyword">var</span> scrollRange = target.scrollHeight - target.clientHeight,
      p = target.scrollTop / scrollRange;
    mediator.pub(<span class="hljs-string">'scroll'</span>, target, p);
  }
}
editor.addEventListener(<span class="hljs-string">'scroll'</span>, updateScroll);
preview.addEventListener(<span class="hljs-string">'scroll'</span>, updateScroll);
</code></pre>
<p>è¿™ä¸€ç‰ˆä»£ç ä¸å‰é¢çš„ä»£ç ç›¸æ¯”çœ‹ä¸Šå»æ›´é•¿äº†ï¼Œä½†æ˜¯å®ƒä¸å†å°†æ‰€æœ‰çš„çŠ¶æ€åŒæ­¥è€¦åˆåœ¨ä¸€ä¸ª<code>update</code>å‡½æ•°é‡Œï¼Œè€Œæ˜¯åˆ†æˆäº†å‘å¸ƒå’Œè®¢é˜…ä¸¤ä¸ªéƒ¨åˆ†ï¼Œè€Œä¸”<code>preview</code>ã€<code>editor</code>ã€<code>hintbar</code>æ˜¯åˆ†åˆ«è®¢é˜…scrollæ¶ˆæ¯çš„ï¼Œè¿™æ ·å°±ä¿è¯äº†UIçŠ¶æ€çš„ç‹¬ç«‹æ€§ã€‚å‡è®¾å°†æ¥æˆ‘ä»¬è¦å–æ¶ˆ<code>hintbar</code>çš„çŠ¶æ€åŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨é‡Šæ‰è®¢é˜…æ¶ˆæ¯çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// mediator.sub('scroll', hintbar, function({data:p}){</span>
<span class="hljs-comment">//   this.innerHTML = Math.round(p * 100) + '%';</span>
<span class="hljs-comment">// });</span>
</code></pre>
<p>è¿™æ ·å°±ä¸éœ€è¦ä¿®æ”¹ä»»ä½•å‡½æ•°çš„å†…éƒ¨å®ç°ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚</p>
<p>å½“æˆ‘ä»¬éœ€è¦åŒæ­¥å¤šä¸ªUIçŠ¶æ€æ—¶ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸­é—´äººæ¨¡å¼ï¼Œç”¨ä¸­é—´äººç»Ÿä¸€ç®¡ç†UIç»„ä»¶çš„æ¶ˆæ¯ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä¸­é—´äººæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä»Šå¤©çš„æ•…äº‹ä¸»è¦è®²è§£äº†å‰ç«¯å¼€å‘ä¸­ä¸¤ä¸ªéå¸¸å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼â€”â€”è¡Œä¸ºæ¨¡å¼å’Œä¸­é—´äººæ¨¡å¼ã€‚è™½ç„¶å‰ç«¯å¼€å‘è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„è®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸ªè¶…å‡ºäº†è¿™é—¨è¯¾çš„èŒƒç•´ã€‚æˆ‘ä»¬ä¼šåœ¨å°†æ¥çš„è®¾è®¡æ¨¡å¼çš„ä¸“é—¨è¯¾ç¨‹ä¸­è¯¦ç»†è®²è§£ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p>
</div>
</body>
</html>