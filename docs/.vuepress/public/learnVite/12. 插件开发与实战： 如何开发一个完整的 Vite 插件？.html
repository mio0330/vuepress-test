<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<!--    <title>Title</title>-->
    <style>
        body {
    font-family: -apple-system, system-ui, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial !important;
}

.markdown-body {
    word-break: break-word;
    line-height: 1.75;
    font-weight: 400;
    font-size: 16px;
    overflow-x: hidden;
    color: #333
}

.markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
    line-height: 1.5;
    margin-top: 35px;
    margin-bottom: 10px;
    padding-bottom: 5px
}

.markdown-body h1 {
    font-size: 24px;
    margin-bottom: 5px
}

.markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
    font-size: 20px
}

.markdown-body h2 {
    padding-bottom: 12px;
    border-bottom: 1px solid #ececec
}

.markdown-body h3 {
    font-size: 18px;
    padding-bottom: 0
}

.markdown-body h6 {
    margin-top: 5px
}

.markdown-body p {
    line-height: inherit;
    margin-top: 22px;
    margin-bottom: 22px
}

.markdown-body img {
    max-width: 100%
}

.markdown-body hr {
    border: none;
    border-top: 1px solid #ddd;
    margin-top: 32px;
    margin-bottom: 32px
}

.markdown-body code {
    word-break: break-word;
    border-radius: 2px;
    overflow-x: auto;
    background-color: #fff5f5;
    color: #ff502c;
    font-size: .87em;
    padding: .065em .4em
}

.markdown-body code, .markdown-body pre {
    font-family: Menlo, Monaco, Consolas, Courier New, monospace
}

.markdown-body pre {
    overflow: auto;
    position: relative;
    line-height: 1.75
}

.markdown-body pre > code {
    font-size: 12px;
    padding: 15px 12px;
    margin: 0;
    word-break: normal;
    display: block;
    overflow-x: auto;
    color: #333;
    background: #f8f8f8
}

.markdown-body a {
    text-decoration: none;
    color: #0269c8;
    border-bottom: 1px solid #d1e9ff
}

.markdown-body a:active, .markdown-body a:hover {
    color: #275b8c
}

.markdown-body table {
    display: inline-block !important;
    font-size: 12px;
    width: auto;
    max-width: 100%;
    overflow: auto;
    border: 1px solid #f6f6f6
}

.markdown-body thead {
    background: #f6f6f6;
    color: #000;
    text-align: left
}

.markdown-body tr:nth-child(2n) {
    background-color: #fcfcfc
}

.markdown-body td, .markdown-body th {
    padding: 12px 7px;
    line-height: 24px
}

.markdown-body td {
    min-width: 120px
}

.markdown-body blockquote {
    color: #666;
    padding: 1px 23px;
    margin: 22px 0;
    border-left: 4px solid #cbcbcb;
    background-color: #f8f8f8
}

.markdown-body blockquote:after {
    display: block;
    content: ""
}

.markdown-body blockquote > p {
    margin: 10px 0
}

.markdown-body ol, .markdown-body ul {
    padding-left: 28px
}

.markdown-body ol li, .markdown-body ul li {
    margin-bottom: 0;
    list-style: inherit
}

.markdown-body ol li .task-list-item, .markdown-body ul li .task-list-item {
    list-style: none
}

.markdown-body ol li .task-list-item ol, .markdown-body ol li .task-list-item ul, .markdown-body ul li .task-list-item ol, .markdown-body ul li .task-list-item ul {
    margin-top: 0
}

.markdown-body ol ol, .markdown-body ol ul, .markdown-body ul ol, .markdown-body ul ul {
    margin-top: 3px
}

.markdown-body ol li {
    padding-left: 6px
}

.markdown-body .contains-task-list {
    padding-left: 0
}

.markdown-body .task-list-item {
    list-style: none
}

@media (max-width: 720px) {
    .markdown-body h1 {
        font-size: 24px
    }

    .markdown-body h2 {
        font-size: 20px
    }

    .markdown-body h3 {
        font-size: 18px
    }
}
    </style>
</head>
<body>
<div class="markdown-body">
    <p>å‰é¢çš„å‡ ä¸ªå°èŠ‚ï¼Œæˆ‘ä»¬ä» Vite åŒå¼•æ“çš„è§’åº¦äº†è§£äº† Vite çš„æ•´ä½“æ¶æ„ï¼Œä¹Ÿç³»ç»Ÿå­¦äº†åŒå¼•æ“æœ¬èº«çš„åŸºç¡€çŸ¥è¯†ã€‚ä»æœ¬å°èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼å­¦ä¹  <strong>Vite é«˜çº§åº”ç”¨</strong>ã€‚</p>
<p>è¿™ä¸€æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥åº”ç”¨ Vite çš„å„é¡¹é«˜çº§èƒ½åŠ›ï¼Œé‡åˆ°æ›´å¤šæœ‰æŒ‘æˆ˜çš„å¼€å‘åœºæ™¯ã€‚ä½ ä¸ä»…èƒ½å­¦ä¼šä¸€ç³»åˆ—æœ‰éš¾åº¦çš„<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼Œç›´æ¥è¿ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œè¿˜èƒ½ç³»ç»Ÿæé«˜è‡ªå·±çš„<strong>çŸ¥è¯†æ·±åº¦</strong>ï¼Œä½“ä¼šå¤æ‚é¡¹ç›®åœºæ™¯ä¸­æ„å»ºå·¥å…·å¦‚ä½•æä¾›é«˜åº¦è‡ªå®šä¹‰çš„èƒ½åŠ›ï¼Œä»¥åŠå¦‚ä½•å¯¹é¡¹ç›®è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>è¯´åˆ°è‡ªå®šä¹‰çš„èƒ½åŠ›ï¼Œä½ è‚¯å®šå¾ˆå®¹æ˜“æƒ³åˆ°<code>æ’ä»¶æœºåˆ¶</code>ï¼Œåˆ©ç”¨ä¸€ä¸ªä¸ªæ’ä»¶æ¥æ‰©å±•æ„å»ºå·¥å…·è‡ªèº«çš„èƒ½åŠ›ã€‚æ²¡é”™ï¼Œè¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬å°†ç³»ç»Ÿå­¦ä¹  Vite çš„æ’ä»¶æœºåˆ¶ï¼Œå¸¦ä½ æŒæ¡ Vite æ’ä»¶å¼€å‘çš„åŸºæœ¬çŸ¥è¯†ä»¥åŠå®æˆ˜å¼€å‘æŠ€å·§ã€‚</p>
<p>è™½ç„¶ Vite çš„æ’ä»¶æœºåˆ¶æ˜¯åŸºäº Rollup æ¥è®¾è®¡çš„ï¼Œå¹¶ä¸”ä¸Šä¸€å°èŠ‚æˆ‘ä»¬ä¹Ÿå·²ç»å¯¹ Rollup çš„æ’ä»¶æœºåˆ¶è¿›è¡Œäº†è¯¦ç»†çš„è§£è¯»ï¼Œä½†å®é™…ä¸Š Vite çš„æ’ä»¶æœºåˆ¶ä¹ŸåŒ…å«äº†è‡ªå·±ç‹¬æœ‰çš„ä¸€éƒ¨åˆ†ï¼Œä¸ Rollup çš„å„ä¸ªæ’ä»¶ Hook å¹¶éå®Œå…¨å…¼å®¹ï¼Œå› æ­¤æœ¬èŠ‚æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ Vite ç‹¬æœ‰çš„éƒ¨åˆ†ä»¥åŠå’Œ Rollup æ‰€åŒºåˆ«çš„éƒ¨åˆ†ï¼Œè€Œå¯¹äº Vite å’Œ Rollup ä¸­ç›¸åŒçš„ Hook (å¦‚<code>resolveId</code>ã€<code>load</code>ã€<code>transform</code>)åªæ˜¯ç¨å¾®æåŠï¼Œå°±ä¸å†å±•å¼€èµ˜è¿°äº†ã€‚</p>
<p>è®©æˆ‘ä»¬å…ˆä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å…¥æ‰‹å§ï¼</p>
<h2>ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹</h2>
<p>Vite æ’ä»¶ä¸ Rollup æ’ä»¶ç»“æ„ç±»ä¼¼ï¼Œä¸ºä¸€ä¸ª<code>name</code>å’Œå„ç§æ’ä»¶ Hook çš„å¯¹è±¡:</p>
<pre><code class="hljs language-ts">{
  <span class="hljs-comment">// æ’ä»¶åç§°</span>
  <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-xxx'</span>,
  <span class="hljs-title function_">load</span>(<span class="hljs-params">code</span>) {
    <span class="hljs-comment">// é’©å­é€»è¾‘</span>
  },
}
</code></pre>
<blockquote>
<p>å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œåœ¨<code>package.json</code>ä¸­çš„åŒ…å‘½åä¹Ÿæ¨èä»¥<code>vite-plugin</code>å¼€å¤´</p>
</blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹å› ä¸ºè¦è€ƒè™‘åˆ°å¤–éƒ¨ä¼ å‚ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥å†™ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯å®ç°ä¸€ä¸ªè¿”å›æ’ä»¶å¯¹è±¡çš„<code>å·¥å‚å‡½æ•°</code>ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// myPlugin.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myVitePlugin</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(options)
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-xxx'</span>,
    <span class="hljs-title function_">load</span>(<span class="hljs-params">id</span>) {
      <span class="hljs-comment">// åœ¨é’©å­é€»è¾‘ä¸­å¯ä»¥é€šè¿‡é—­åŒ…è®¿é—®å¤–éƒ¨çš„ options ä¼ å‚</span>
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { myVitePlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./myVitePlugin'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">myVitePlugin</span>({ <span class="hljs-comment">/* ç»™æ’ä»¶ä¼ å‚ */</span> })]
}
</code></pre>
<h2>æ’ä»¶ Hook ä»‹ç»</h2>
<h3>1. é€šç”¨ Hook</h3>
<p>åœ¨<a href="https://juejin.cn/book/7050063811973218341/section/7060398408430780431" target="_blank" rel="nofollow noopener noreferrer">åŒå¼•æ“æ¶æ„</a>è¿™ä¸€èŠ‚ä¸­ä»‹ç»è¿‡ï¼ŒVite <strong>å¼€å‘é˜¶æ®µ</strong>ä¼šæ¨¡æ‹Ÿ Rollup çš„è¡Œä¸º:</p>
<p><img src="img\bb02446c-ae61-11ed-8853-342eb7027b95.jpg" alt="image.png"></p>
<p>å…¶ä¸­ Vite ä¼šè°ƒç”¨ä¸€ç³»åˆ—ä¸ Rollup å…¼å®¹çš„é’©å­ï¼Œè¿™ä¸ªé’©å­ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:</p>
<ul>
<li><strong>æœåŠ¡å™¨å¯åŠ¨é˜¶æ®µ</strong>: <code>options</code>å’Œ<code>buildStart</code>é’©å­ä¼šåœ¨æœåŠ¡å¯åŠ¨æ—¶è¢«è°ƒç”¨ã€‚</li>
<li><strong>è¯·æ±‚å“åº”é˜¶æ®µ</strong>: å½“æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼ŒVite å†…éƒ¨ä¾æ¬¡è°ƒç”¨<code>resolveId</code>ã€<code>load</code>å’Œ<code>transform</code>é’©å­ã€‚</li>
<li><strong>æœåŠ¡å™¨å…³é—­é˜¶æ®µ</strong>: Vite ä¼šä¾æ¬¡æ‰§è¡Œ<code>buildEnd</code>å’Œ<code>closeBundle</code>é’©å­ã€‚</li>
</ul>
<p>é™¤äº†ä»¥ä¸Šé’©å­ï¼Œå…¶ä»– Rollup æ’ä»¶é’©å­(å¦‚<code>moduleParsed</code>ã€<code>renderChunk</code>)å‡ä¸ä¼šåœ¨ Vite <strong>å¼€å‘é˜¶æ®µ</strong>è°ƒç”¨ã€‚è€Œç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œç”±äº Vite ç›´æ¥ä½¿ç”¨ Rollupï¼ŒVite æ’ä»¶ä¸­æ‰€æœ‰ Rollup çš„æ’ä»¶é’©å­éƒ½ä¼šç”Ÿæ•ˆã€‚</p>
<h3>2. ç‹¬æœ‰ Hook</h3>
<p>æ¥ä¸‹æ¥ç»™å¤§å®¶ä»‹ç» Vite ä¸­ç‰¹æœ‰çš„ä¸€äº› Hookï¼Œè¿™äº› Hook åªä¼šåœ¨ Vite å†…éƒ¨è°ƒç”¨ï¼Œè€Œæ”¾åˆ° Rollup ä¸­ä¼šè¢«ç›´æ¥å¿½ç•¥ã€‚</p>
<h4>2.1 ç»™é…ç½®å†åŠ ç‚¹æ–™: config</h4>
<p>Vite åœ¨è¯»å–å®Œé…ç½®æ–‡ä»¶ï¼ˆå³<code>vite.config.ts</code>ï¼‰ä¹‹åï¼Œä¼šæ‹¿åˆ°ç”¨æˆ·å¯¼å‡ºçš„é…ç½®å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œ config é’©å­ã€‚åœ¨è¿™ä¸ªé’©å­é‡Œé¢ï¼Œä½ å¯ä»¥å¯¹é…ç½®æ–‡ä»¶å¯¼å‡ºçš„å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// è¿”å›éƒ¨åˆ†é…ç½®ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">editConfigPlugin</span> = (<span class="hljs-params"></span>) => ({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-modify-config'</span>,
  <span class="hljs-attr">config</span>: <span class="hljs-function">() =></span> ({
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-attr">react</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'react'</span>)
    }
  })
})
</code></pre>
<p>å®˜æ–¹æ¨èçš„å§¿åŠ¿æ˜¯åœ¨ config é’©å­ä¸­è¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œè¿™ä¸ªé…ç½®å¯¹è±¡ä¼šå’Œ Vite å·²æœ‰çš„é…ç½®è¿›è¡Œæ·±åº¦çš„åˆå¹¶ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€šè¿‡é’©å­çš„å…¥å‚æ‹¿åˆ° config å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„ä¿®æ”¹ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">mutateConfigPlugin</span> = (<span class="hljs-params"></span>) => ({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'mutate-config'</span>,
  <span class="hljs-comment">// command ä¸º `serve`(å¼€å‘ç¯å¢ƒ) æˆ–è€… `build`(ç”Ÿäº§ç¯å¢ƒ)</span>
  <span class="hljs-title function_">config</span>(<span class="hljs-params">config, { command }</span>) {
    <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹ root å‚æ•°</span>
    <span class="hljs-keyword">if</span> (command === <span class="hljs-string">'build'</span>) {
      config.<span class="hljs-property">root</span> = __dirname;
    }
  }
})
</code></pre>
<p>åœ¨ä¸€äº›æ¯”è¾ƒæ·±å±‚çš„å¯¹è±¡é…ç½®ä¸­ï¼Œè¿™ç§ç›´æ¥ä¿®æ”¹é…ç½®çš„æ–¹å¼ä¼šæ˜¾å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚ <code>optimizeDeps.esbuildOptions.plugins</code>ï¼Œéœ€è¦å†™å¾ˆå¤šçš„æ ·æ¿ä»£ç ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// é˜²æ­¢å‡ºç° undefined çš„æƒ…å†µ</span>
config.<span class="hljs-property">optimizeDeps</span> = config.<span class="hljs-property">optimizeDeps</span> || {}
config.<span class="hljs-property">optimizeDeps</span>.<span class="hljs-property">esbuildOptions</span> = config.<span class="hljs-property">optimizeDeps</span>.<span class="hljs-property">esbuildOptions</span> || {}
config.<span class="hljs-property">optimizeDeps</span>.<span class="hljs-property">esbuildOptions</span>.<span class="hljs-property">plugins</span> = config.<span class="hljs-property">optimizeDeps</span>.<span class="hljs-property">esbuildOptions</span>.<span class="hljs-property">plugins</span> || []
</code></pre>
<p>å› æ­¤è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ç›´æ¥è¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œè¿™æ ·ä¼šæ–¹ä¾¿å¾ˆå¤š:</p>
<pre><code class="hljs language-ts"><span class="hljs-title function_">config</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">optimizeDeps</span>: {
      <span class="hljs-attr">esbuildOptions</span>: {
        <span class="hljs-attr">plugins</span>: []
      }
    }
  }
}
</code></pre>
<h4>2.2 è®°å½•æœ€ç»ˆé…ç½®: configResolved</h4>
<p>Vite åœ¨è§£æå®Œé…ç½®ä¹‹åä¼šè°ƒç”¨<code>configResolved</code>é’©å­ï¼Œè¿™ä¸ªé’©å­ä¸€èˆ¬ç”¨æ¥è®°å½•æœ€ç»ˆçš„é…ç½®ä¿¡æ¯ï¼Œè€Œä¸å»ºè®®å†ä¿®æ”¹é…ç½®ï¼Œç”¨æ³•å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">exmaplePlugin</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-keyword">let</span> config

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'read-config'</span>,

    <span class="hljs-title function_">configResolved</span>(<span class="hljs-params">resolvedConfig</span>) {
      <span class="hljs-comment">// è®°å½•æœ€ç»ˆé…ç½®</span>
      config = resolvedConfig
    },

    <span class="hljs-comment">// åœ¨å…¶ä»–é’©å­ä¸­å¯ä»¥è®¿é—®åˆ°é…ç½®</span>
    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(config)
    }
  }
}
</code></pre>
<h4>2.3 è·å– Dev Server å®ä¾‹: configureServer</h4>
<p>è¿™ä¸ªé’©å­ä»…åœ¨<strong>å¼€å‘é˜¶æ®µ</strong>ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºæ‰©å±• Vite çš„ Dev Serverï¼Œä¸€èˆ¬ç”¨äºå¢åŠ è‡ªå®šä¹‰ server ä¸­é—´ä»¶ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">myPlugin</span> = (<span class="hljs-params"></span>) => ({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'configure-server'</span>,
  <span class="hljs-title function_">configureServer</span>(<span class="hljs-params">server</span>) {
    <span class="hljs-comment">// å§¿åŠ¿ 1: åœ¨ Vite å†…ç½®ä¸­é—´ä»¶ä¹‹å‰æ‰§è¡Œ</span>
    server.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =></span> {
      <span class="hljs-comment">// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†é€»è¾‘</span>
    })
    <span class="hljs-comment">// å§¿åŠ¿ 2: åœ¨ Vite å†…ç½®ä¸­é—´ä»¶ä¹‹åæ‰§è¡Œ </span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =></span> {
      server.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =></span> {
        <span class="hljs-comment">// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†é€»è¾‘</span>
      })
    }
  }
})
</code></pre>
<h4>2.4 è½¬æ¢ HTML å†…å®¹: transformIndexHtml</h4>
<p>è¿™ä¸ªé’©å­ç”¨æ¥çµæ´»æ§åˆ¶ HTML çš„å†…å®¹ï¼Œä½ å¯ä»¥æ‹¿åˆ°åŸå§‹çš„ html å†…å®¹åè¿›è¡Œä»»æ„çš„è½¬æ¢:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">htmlPlugin</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'html-transform'</span>,
    <span class="hljs-title function_">transformIndexHtml</span>(<span class="hljs-params">html</span>) {
      <span class="hljs-keyword">return</span> html.<span class="hljs-title function_">replace</span>(
        <span class="hljs-regexp">/&#x3C;title>(.*?)&#x3C;/</span>title>/,
        <span class="hljs-string">`&#x3C;title>æ¢äº†ä¸ªæ ‡é¢˜&#x3C;/title>`</span>
      )
    }
  }
}
<span class="hljs-comment">// ä¹Ÿå¯ä»¥è¿”å›å¦‚ä¸‹çš„å¯¹è±¡ç»“æ„ï¼Œä¸€èˆ¬ç”¨äºæ·»åŠ æŸäº›æ ‡ç­¾</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">htmlPlugin</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'html-transform'</span>,
    <span class="hljs-title function_">transformIndexHtml</span>(<span class="hljs-params">html</span>) {
      <span class="hljs-keyword">return</span> {
        html,
        <span class="hljs-comment">// æ³¨å…¥æ ‡ç­¾</span>
        <span class="hljs-attr">tags</span>: [
          {
            <span class="hljs-comment">// æ”¾åˆ° body æœ«å°¾ï¼Œå¯å–å€¼è¿˜æœ‰`head`|`head-prepend`|`body-prepend`ï¼Œé¡¾åæ€ä¹‰</span>
            <span class="hljs-attr">injectTo</span>: <span class="hljs-string">'body'</span>,
            <span class="hljs-comment">// æ ‡ç­¾å±æ€§å®šä¹‰</span>
            <span class="hljs-attr">attrs</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'module'</span>, <span class="hljs-attr">src</span>: <span class="hljs-string">'./index.ts'</span> },
            <span class="hljs-comment">// æ ‡ç­¾å</span>
            <span class="hljs-attr">tag</span>: <span class="hljs-string">'script'</span>,
          },
        ],
      }
    }
  }
}
</code></pre>
<h4>2.5 çƒ­æ›´æ–°å¤„ç†: handleHotUpdate</h4>
<blockquote>
<p>å…³äºçƒ­æ›´æ–°çš„æ¦‚å¿µå’ŒåŸç†ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚å…·ä½“è®²è§£ã€‚</p>
</blockquote>
<p>è¿™ä¸ªé’©å­ä¼šåœ¨ Vite æœåŠ¡ç«¯å¤„ç†çƒ­æ›´æ–°æ—¶è¢«è°ƒç”¨ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­æ‹¿åˆ°çƒ­æ›´æ–°ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿›è¡Œçƒ­æ›´æ¨¡å—çš„è¿‡æ»¤ï¼Œæˆ–è€…è¿›è¡Œè‡ªå®šä¹‰çš„çƒ­æ›´å¤„ç†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleHmrPlugin</span> = (<span class="hljs-params"></span>) => {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleHotUpdate</span>(<span class="hljs-params">ctx</span>) {
      <span class="hljs-comment">// éœ€è¦çƒ­æ›´çš„æ–‡ä»¶</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ctx.<span class="hljs-property">file</span>)
      <span class="hljs-comment">// éœ€è¦çƒ­æ›´çš„æ¨¡å—ï¼Œå¦‚ä¸€ä¸ª Vue å•æ–‡ä»¶ä¼šæ¶‰åŠå¤šä¸ªæ¨¡å—</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ctx.<span class="hljs-property">modules</span>)
      <span class="hljs-comment">// æ—¶é—´æˆ³</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ctx.<span class="hljs-property">timestamp</span>)
      <span class="hljs-comment">// Vite Dev Server å®ä¾‹</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ctx.<span class="hljs-property">server</span>)
      <span class="hljs-comment">// è¯»å–æœ€æ–°çš„æ–‡ä»¶å†…å®¹</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">read</span>())
      <span class="hljs-comment">// è‡ªè¡Œå¤„ç† HMR äº‹ä»¶</span>
      ctx.<span class="hljs-property">server</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'custom'</span>,
        <span class="hljs-attr">event</span>: <span class="hljs-string">'special-update'</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }
      })
      <span class="hljs-keyword">return</span> []
    }
  }
}

<span class="hljs-comment">// å‰ç«¯ä»£ç ä¸­åŠ å…¥</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>) {
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'special-update'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =></span> {
    <span class="hljs-comment">// æ‰§è¡Œè‡ªå®šä¹‰æ›´æ–°</span>
    <span class="hljs-comment">// { a: 1 }</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>();
  })
}
</code></pre>
<p>ä»¥ä¸Šå°±æ˜¯ Vite ç‹¬æœ‰çš„äº”ä¸ªé’©å­ï¼Œæˆ‘ä»¬æ¥é‡æ–°æ¢³ç†ä¸€ä¸‹:</p>
<ul>
<li><code>config</code>: ç”¨æ¥è¿›ä¸€æ­¥ä¿®æ”¹é…ç½®ã€‚</li>
<li><code>configResolved</code>: ç”¨æ¥è®°å½•æœ€ç»ˆçš„é…ç½®ä¿¡æ¯ã€‚</li>
<li><code>configureServer</code>: ç”¨æ¥è·å– Vite Dev Server å®ä¾‹ï¼Œæ·»åŠ ä¸­é—´ä»¶ã€‚</li>
<li><code>transformIndexHtml</code>: ç”¨æ¥è½¬æ¢ HTML çš„å†…å®¹ã€‚</li>
<li><code>handleHotUpdate</code>: ç”¨æ¥è¿›è¡Œçƒ­æ›´æ–°æ¨¡å—çš„è¿‡æ»¤ï¼Œæˆ–è€…è¿›è¡Œè‡ªå®šä¹‰çš„çƒ­æ›´æ–°å¤„ç†ã€‚</li>
</ul>
<h3>3. æ’ä»¶ Hook æ‰§è¡Œé¡ºåº</h3>
<p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬å­¦ä¹ åˆ°äº† Vite çš„é€šç”¨é’©å­å’Œç‹¬æœ‰é’©å­ï¼Œä¼°è®¡ä½ ç°åœ¨è„‘å­é‡Œé¢ä¸€ç‚¹ä¹±: è¿™ä¹ˆå¤šçš„é’©å­ï¼Œåˆ°åº•è°å…ˆæ‰§è¡Œã€è°åæ‰§è¡Œå‘¢ï¼Ÿ</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥å¤ç›˜ä¸€ä¸‹ä¸Šè¿°çš„ä¸¤ç±»é’©å­ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä»£ç ç¤ºä¾‹æ¥æ±‡æ€»ä¸€ä¸‹æ‰€æœ‰çš„é’©å­ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Vite çš„è„šæ‰‹æ¶å·¥ç¨‹ä¸­æ–°å»º <code>test-hooks-plugin.ts</code>:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// test-hooks-plugin.ts</span>
<span class="hljs-comment">// æ³¨: è¯·æ±‚å“åº”é˜¶æ®µçš„é’©å­</span>
<span class="hljs-comment">// å¦‚ resolveId, load, transform, transformIndexHtmlåœ¨ä¸‹æ–‡ä»‹ç»</span>
<span class="hljs-comment">// ä»¥ä¸‹ä¸ºæœåŠ¡å¯åŠ¨å’Œå…³é—­çš„é’©å­</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">testHookPlugin</span> () {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'test-hooks-plugin'</span>, 
    <span class="hljs-comment">// Vite ç‹¬æœ‰é’©å­</span>
    <span class="hljs-title function_">config</span>(<span class="hljs-params">config</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'config'</span>);
    },
    <span class="hljs-comment">// Vite ç‹¬æœ‰é’©å­</span>
    <span class="hljs-title function_">configResolved</span>(<span class="hljs-params">resolvedCofnig</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'configResolved'</span>);
    },
    <span class="hljs-comment">// é€šç”¨é’©å­</span>
    <span class="hljs-title function_">options</span>(<span class="hljs-params">opts</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'options'</span>);
      <span class="hljs-keyword">return</span> opts;
    },
    <span class="hljs-comment">// Vite ç‹¬æœ‰é’©å­</span>
    <span class="hljs-title function_">configureServer</span>(<span class="hljs-params">server</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'configureServer'</span>);
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
        <span class="hljs-comment">// æ‰‹åŠ¨é€€å‡ºè¿›ç¨‹</span>
        process.<span class="hljs-title function_">kill</span>(process.<span class="hljs-property">pid</span>, <span class="hljs-string">'SIGTERM'</span>);
      }, <span class="hljs-number">3000</span>)
    },
    <span class="hljs-comment">// é€šç”¨é’©å­</span>
    <span class="hljs-title function_">buildStart</span>(<span class="hljs-params"></span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'buildStart'</span>);
    },
    <span class="hljs-comment">// é€šç”¨é’©å­</span>
    <span class="hljs-title function_">buildEnd</span>(<span class="hljs-params"></span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'buildEnd'</span>);
    },
    <span class="hljs-comment">// é€šç”¨é’©å­</span>
    <span class="hljs-title function_">closeBundle</span>(<span class="hljs-params"></span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'closeBundle'</span>);
    }
}
</code></pre>
<p>å°†æ’ä»¶åŠ å…¥åˆ° Vite é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åå¯åŠ¨ï¼Œä½ å¯ä»¥è§‚å¯Ÿåˆ°å„ä¸ª Hook çš„æ‰§è¡Œé¡ºåº:</p>
<p><img src="img\bb214998-ae61-11ed-8618-342eb7027b95.jpg" alt="image.png"></p>
<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¢³ç†å‡º Vite æ’ä»¶çš„æ‰§è¡Œé¡ºåº:</p>
<p><img src="img\bb396719-ae61-11ed-9717-342eb7027b95.jpg" alt="image.png"></p>
<ul>
<li>æœåŠ¡å¯åŠ¨é˜¶æ®µ: <code>config</code>ã€<code>configResolved</code>ã€<code>options</code>ã€<code>configureServer</code>ã€<code>buildStart</code></li>
<li>è¯·æ±‚å“åº”é˜¶æ®µ: å¦‚æœæ˜¯ <code>html</code> æ–‡ä»¶ï¼Œä»…æ‰§è¡Œ<code>transformIndexHtml</code>é’©å­ï¼›å¯¹äºé HTML æ–‡ä»¶ï¼Œåˆ™ä¾æ¬¡æ‰§è¡Œ<code>resolveId</code>ã€<code>load</code>å’Œ<code>transform</code>é’©å­ã€‚ç›¸ä¿¡å¤§å®¶å­¦è¿‡ Rollup çš„æ’ä»¶æœºåˆ¶ï¼Œå·²ç»å¯¹è¿™ä¸‰ä¸ªé’©å­æ¯”è¾ƒç†Ÿæ‚‰äº†ã€‚</li>
<li>çƒ­æ›´æ–°é˜¶æ®µ: æ‰§è¡Œ<code>handleHotUpdate</code>é’©å­ã€‚</li>
<li>æœåŠ¡å…³é—­é˜¶æ®µ: ä¾æ¬¡æ‰§è¡Œ<code>buildEnd</code>å’Œ<code>closeBundle</code>é’©å­ã€‚</li>
</ul>
<h2>æ’ä»¶åº”ç”¨ä½ç½®</h2>
<p>æ¢³ç†å®Œ Vite çš„å„ä¸ªé’©å­å‡½æ•°ä¹‹åï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ Vite æ’ä»¶çš„<strong>åº”ç”¨æƒ…æ™¯</strong>å’Œ<strong>åº”ç”¨é¡ºåº</strong>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ Vite æ’ä»¶åŒæ—¶è¢«ç”¨äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œä½ å¯ä»¥é€šè¿‡<code>apply</code>å±æ€§æ¥å†³å®šåº”ç”¨åœºæ™¯:</p>
<pre><code class="hljs language-ts">{
  <span class="hljs-comment">// 'serve' è¡¨ç¤ºä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼Œ'build'è¡¨ç¤ºä»…ç”¨äºç”Ÿäº§ç¯å¢ƒ</span>
  <span class="hljs-attr">apply</span>: <span class="hljs-string">'serve'</span>
}
</code></pre>
<p><code>apply</code>å‚æ•°è¿˜å¯ä»¥é…ç½®æˆä¸€ä¸ªå‡½æ•°ï¼Œè¿›è¡Œæ›´çµæ´»çš„æ§åˆ¶:</p>
<pre><code class="hljs language-ts![plugin.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a93a37e0e4344b97b55bd67afe51d511~tplv-k3u1fbpfcp-zoom-1.image)">apply(config, { command }) {
  // åªç”¨äºé SSR æƒ…å†µä¸‹çš„ç”Ÿäº§ç¯å¢ƒæ„å»º
  return command === 'build' &#x26;&#x26; !config.build.ssr
}
</code></pre>
<p>åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡<code>enforce</code>å±æ€§æ¥æŒ‡å®šæ’ä»¶çš„æ‰§è¡Œé¡ºåº:</p>
<pre><code class="hljs language-ts">{
  <span class="hljs-comment">// é»˜è®¤ä¸º`normal`ï¼Œå¯å–å€¼è¿˜æœ‰`pre`å’Œ`post`</span>
  <span class="hljs-attr">enforce</span>: <span class="hljs-string">'pre'</span>
}
</code></pre>
<p>Vite ä¸­æ’ä»¶çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="img\bb4e2894-ae61-11ed-a5d0-342eb7027b95.jpg" alt="plugin.png"></p>
<p>Vite ä¼šä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹çš„æ’ä»¶:</p>
<blockquote>
</blockquote>
<ul>
<li>Alias (è·¯å¾„åˆ«å)ç›¸å…³çš„æ’ä»¶ã€‚</li>
<li>â­ï¸ å¸¦æœ‰Â <code>enforce: 'pre'</code>Â çš„ç”¨æˆ·æ’ä»¶ã€‚</li>
<li>Vite æ ¸å¿ƒæ’ä»¶ã€‚</li>
<li>â­ï¸ æ²¡æœ‰ enforce å€¼çš„ç”¨æˆ·æ’ä»¶ï¼Œä¹Ÿå«<code>æ™®é€šæ’ä»¶</code>ã€‚</li>
<li>Vite ç”Ÿäº§ç¯å¢ƒæ„å»ºç”¨çš„æ’ä»¶ã€‚</li>
<li>â­ï¸ å¸¦æœ‰Â <code>enforce: 'post'</code>Â çš„ç”¨æˆ·æ’ä»¶ã€‚</li>
<li>Vite åç½®æ„å»ºæ’ä»¶(å¦‚å‹ç¼©æ’ä»¶)ã€‚</li>
</ul>
<h2>æ’ä»¶å¼€å‘å®æˆ˜</h2>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥æ’ä»¶å¼€å‘çš„å®æˆ˜ç¯èŠ‚ä¸­ï¼Œåœ¨è¿™ä¸ªéƒ¨åˆ†æˆ‘ä»¬å°†ä¸€èµ·ç¼–å†™ä¸¤ä¸ª Vite æ’ä»¶ï¼Œåˆ†åˆ«æ˜¯<code>è™šæ‹Ÿæ¨¡å—åŠ è½½æ’ä»¶</code>å’Œ<code>Svgr æ’ä»¶</code>ï¼Œä½ å°†å­¦ä¼šä»æ’ä»¶å¼€å‘çš„å¸¸è§å¥—è·¯å’Œå„ç§å¼€å‘æŠ€å·§ã€‚è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬ç°åœ¨å¼€å§‹å®æˆ˜å§ã€‚</p>
<h3>å®æˆ˜æ¡ˆä¾‹ 1: è™šæ‹Ÿæ¨¡å—åŠ è½½</h3>
<p>é¦–å…ˆæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªè™šæ‹Ÿæ¨¡å—çš„åŠ è½½æ’ä»¶ï¼Œå¯èƒ½ä½ ä¼šæœ‰ç–‘é—®: ä»€ä¹ˆæ˜¯è™šæ‹Ÿæ¨¡å—å‘¢ï¼Ÿ</p>
<p>ä½œä¸ºæ„å»ºå·¥å…·ï¼Œä¸€èˆ¬éœ€è¦å¤„ç†ä¸¤ç§å½¢å¼çš„æ¨¡å—ï¼Œä¸€ç§å­˜åœ¨äºçœŸå®çš„ç£ç›˜æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¦ä¸€ç§å¹¶ä¸åœ¨ç£ç›˜è€Œåœ¨å†…å­˜å½“ä¸­ï¼Œä¹Ÿå°±æ˜¯<code>è™šæ‹Ÿæ¨¡å—</code>ã€‚é€šè¿‡è™šæ‹Ÿæ¨¡å—ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥æŠŠè‡ªå·±æ‰‹å†™çš„ä¸€äº›ä»£ç å­—ç¬¦ä¸²ä½œä¸ºå•ç‹¬çš„æ¨¡å—å†…å®¹ï¼Œåˆå¯ä»¥å°†å†…å­˜ä¸­æŸäº›ç»è¿‡è®¡ç®—å¾—å‡ºçš„<strong>å˜é‡</strong>ä½œä¸ºæ¨¡å—å†…å®¹è¿›è¡ŒåŠ è½½ï¼Œéå¸¸çµæ´»å’Œæ–¹ä¾¿ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­æ¥å®æ“ä¸€ä¸‹ï¼Œé¦–å…ˆé€šè¿‡è„šæ‰‹æ¶å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ª<code>react + ts</code>é¡¹ç›®:</p>
<pre><code class="hljs language-ts">npm init vite
</code></pre>
<p>ç„¶åé€šè¿‡<code>pnpm i</code>å®‰è£…ä¾èµ–ï¼Œæ¥ç€æ–°å»º<code>plugins</code>ç›®å½•ï¼Œå¼€å§‹æ’ä»¶çš„å¼€å‘:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// plugins/virtual-module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Plugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;

<span class="hljs-comment">// è™šæ‹Ÿæ¨¡å—åç§°</span>
<span class="hljs-keyword">const</span> virtualFibModuleId = <span class="hljs-string">'virtual:fib'</span>;
<span class="hljs-comment">// Vite ä¸­çº¦å®šå¯¹äºè™šæ‹Ÿæ¨¡å—ï¼Œè§£æåçš„è·¯å¾„éœ€è¦åŠ ä¸Š`\0`å‰ç¼€</span>
<span class="hljs-keyword">const</span> resolvedFibVirtualModuleId = <span class="hljs-string">'\0'</span> + virtualFibModuleId;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">virtualFibModulePlugin</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ResolvedConfig</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-virtual-module'</span>,
    <span class="hljs-title function_">resolveId</span>(<span class="hljs-params">id</span>) {
      <span class="hljs-keyword">if</span> (id === virtualFibModuleId) { 
        <span class="hljs-keyword">return</span> resolvedFibVirtualModuleId;
      }
    },
    <span class="hljs-title function_">load</span>(<span class="hljs-params">id</span>) {
      <span class="hljs-comment">// åŠ è½½è™šæ‹Ÿæ¨¡å—</span>
      <span class="hljs-keyword">if</span> (id === resolvedFibVirtualModuleId) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'export default function fib(n) { return n &#x3C;= 1 ? n : fib(n - 1) + fib(n - 2); }'</span>;
      }
    }
  }
}
</code></pre>
<p>æ¥ç€æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ¥ä½¿ç”¨è¿™ä¸ªæ’ä»¶:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> virtual <span class="hljs-keyword">from</span> <span class="hljs-string">'./plugins/virtual-module.ts'</span>

<span class="hljs-comment">// é…ç½®æ’ä»¶</span>
{
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>(), <span class="hljs-title function_">virtual</span>()]
}
</code></pre>
<p>ç„¶ååœ¨<code>main.tsx</code>ä¸­åŠ å…¥å¦‚ä¸‹çš„ä»£ç :</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> fib <span class="hljs-keyword">from</span> <span class="hljs-string">'virtual:fib'</span>;

<span class="hljs-title function_">alert</span>(<span class="hljs-string">`ç»“æœ: <span class="hljs-subst">${fib(<span class="hljs-number">10</span>)}</span>`</span>)
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>virtual:fib</code> è¿™ä¸ªè™šæ‹Ÿæ¨¡å—ï¼Œè™½ç„¶è¿™ä¸ªæ¨¡å—ä¸å­˜åœ¨çœŸå®çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½†ä½ æ‰“å¼€æµè§ˆå™¨åå¯ä»¥å‘ç°è¿™ä¸ªæ¨¡å—å¯¼å‡ºçš„å‡½æ•°æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„:</p>
<p><img src="img\bb6b9197-ae61-11ed-bff2-342eb7027b95.jpg" alt="image.png"></p>
<p>æ¥ç€æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹å¦‚ä½•é€šè¿‡è™šæ‹Ÿæ¨¡å—æ¥è¯»å–å†…å­˜ä¸­çš„å˜é‡ï¼Œåœ¨<code>virtual-module.ts</code>ä¸­å¢åŠ å¦‚ä¸‹ä»£ç :</p>
<pre><code class="hljs language-diff">import { Plugin, ResolvedConfig } from 'vite';

const virtualFibModuleId = 'virtual:fib';
const resolvedFibVirtualModuleId = '\0' + virtualFibModuleId;

<span class="hljs-addition">+ const virtualEnvModuleId = 'virtual:env';</span>
<span class="hljs-addition">+ const resolvedEnvVirtualModuleId = '\0' + virtualEnvModuleId;</span>

export default function virtualFibModulePlugin(): Plugin {
<span class="hljs-addition">+   let config: ResolvedConfig | null = null;</span>
  return {
    name: 'vite-plugin-virtual-fib-module',
<span class="hljs-addition">+     configResolved(c: ResolvedConfig) {</span>
<span class="hljs-addition">+       config = c;</span>
<span class="hljs-addition">+     },</span>
    resolveId(id) {
      if (id <span class="hljs-comment">=== virtualFibModuleId) { </span>
        return resolvedFibVirtualModuleId;
      }
<span class="hljs-addition">+       if (id === virtualEnvModuleId) { </span>
<span class="hljs-addition">+        return resolvedEnvVirtualModuleId;</span>
<span class="hljs-addition">+      }</span>
    },
    load(id) {
      if (id <span class="hljs-comment">=== resolvedFibVirtualModuleId) {</span>
        return 'export default function fib(n) { return n &#x3C;= 1 ? n : fib(n - 1) + fib(n - 2); }';
      }
<span class="hljs-addition">+      if (id === resolvedEnvVirtualModuleId) {</span>
<span class="hljs-addition">+        return `export default ${JSON.stringify(config!.env)}`;</span>
<span class="hljs-addition">+      }</span>
    }
  }
}
</code></pre>
<p>åœ¨æ–°å¢çš„è¿™äº›ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªæ–°çš„è™šæ‹Ÿæ¨¡å—<code>virtual:env</code>ï¼Œç´§æ¥ç€æˆ‘ä»¬å»é¡¹ç›®å»ä½¿ç”¨:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// main.tsx</span>
<span class="hljs-keyword">import</span> env <span class="hljs-keyword">from</span> <span class="hljs-string">'virtual:env'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(env)
</code></pre>
<p><code>virtual:env</code>ä¸€èˆ¬æƒ…å†µä¸‹ä¼šæœ‰ç±»å‹é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ä¸ªç±»å‹å£°æ˜æ–‡ä»¶æ¥å£°æ˜è¿™ä¸ªæ¨¡å—:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// types/shim.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'virtual:*'</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-built_in">any</span>;
}
</code></pre>
<p>è¿™æ ·å°±è§£å†³äº†ç±»å‹æŠ¥é”™çš„é—®é¢˜ã€‚æ¥ç€ä½ å¯ä»¥å»æµè§ˆå™¨è§‚å¯Ÿä¸€ä¸‹è¾“å‡ºçš„æƒ…å†µ:</p>
<p><img src="img\bb7cd6a2-ae61-11ed-a15d-342eb7027b95.jpg" alt="image.png"></p>
<p>Vite ç¯å¢ƒå˜é‡èƒ½æ­£ç¡®åœ°åœ¨æµè§ˆå™¨ä¸­æ‰“å°å‡ºæ¥ï¼Œè¯´æ˜åœ¨å†…å­˜ä¸­è®¡ç®—å‡ºæ¥çš„<code>virtual:env</code>æ¨¡å—çš„ç¡®è¢«æˆåŠŸåœ°åŠ è½½äº†ã€‚ä»ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œè™šæ‹Ÿæ¨¡å—çš„å†…å®¹å®Œå…¨èƒ½å¤Ÿè¢«åŠ¨æ€è®¡ç®—å‡ºæ¥ï¼Œå› æ­¤å®ƒçš„çµæ´»æ€§å’Œå¯å®šåˆ¶ç¨‹åº¦éå¸¸é«˜ï¼Œå®ç”¨æ€§ä¹Ÿå¾ˆå¼ºï¼Œåœ¨ Vite å†…éƒ¨çš„æ’ä»¶è¢«æ·±åº¦åœ°ä½¿ç”¨ï¼Œç¤¾åŒºå½“ä¸­ä¹Ÿæœ‰ä¸å°‘çŸ¥åçš„æ’ä»¶(å¦‚ <code>vite-plugin-windicss</code>ã€<code>vite-plugin-svg-icons</code>ç­‰)ä¹Ÿä½¿ç”¨äº†è™šæ‹Ÿæ¨¡å—çš„æŠ€æœ¯ã€‚</p>
<h3>å®æˆ˜æ¡ˆä¾‹ 2: Svg ç»„ä»¶å½¢å¼åŠ è½½</h3>
<p>åœ¨ä¸€èˆ¬çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™å¸Œæœ›èƒ½å°† svg å½“åšä¸€ä¸ªç»„ä»¶æ¥å¼•å…¥ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¿®æ”¹ svg çš„å„ç§å±æ€§ï¼Œç›¸æ¯”äº<code>img</code>æ ‡ç­¾çš„å¼•å…¥æ–¹å¼ä¹Ÿæ›´åŠ ä¼˜é›…ã€‚ä½† Vite æœ¬èº«å¹¶ä¸æ”¯æŒå°† svg è½¬æ¢ä¸ºç»„ä»¶çš„ä»£ç ï¼Œéœ€è¦æˆ‘ä»¬é€šè¿‡æ’ä»¶æ¥å®ç°ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ª Vite æ’ä»¶ï¼Œå®ç°åœ¨ React é¡¹ç›®èƒ½å¤Ÿé€šè¿‡ç»„ä»¶æ–¹å¼æ¥ä½¿ç”¨ svg èµ„æºã€‚é¦–å…ˆå®‰è£…ä¸€ä¸‹éœ€è¦çš„ä¾èµ–:</p>
<pre><code class="hljs language-bash">pnpm i resolve @svgr/core -D
</code></pre>
<p>æ¥ç€åœ¨<code>plugins</code>ç›®å½•æ–°å»º <code>svgr.ts</code>:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Plugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> resolve <span class="hljs-keyword">from</span> <span class="hljs-string">'resolve'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SvgrOptions</span> {
  <span class="hljs-comment">// svg èµ„æºæ¨¡å—é»˜è®¤å¯¼å‡ºï¼Œurl æˆ–è€…ç»„ä»¶</span>
  <span class="hljs-attr">defaultExport</span>: <span class="hljs-string">'url'</span> | <span class="hljs-string">'component'</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">viteSvgrPlugin</span>(<span class="hljs-params">options: SvgrOptions</span>) {
  <span class="hljs-keyword">const</span> { defaultExport=<span class="hljs-string">'url'</span> } = options;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-svgr'</span>,
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">code ,id</span>) {
      <span class="hljs-comment">// è½¬æ¢é€»è¾‘: svg -> React ç»„ä»¶</span>
    }
  }
}
</code></pre>
<p>è®©æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹å¼€å‘éœ€æ±‚ï¼Œç”¨æˆ·é€šè¿‡ä¼ å…¥<code>defaultExport</code>å¯ä»¥æ§åˆ¶ svg èµ„æºçš„é»˜è®¤å¯¼å‡º:</p>
<ul>
<li>å½“ <code>defaultExport</code>ä¸º <code>component</code>ï¼Œé»˜è®¤å½“åšç»„ä»¶æ¥ä½¿ç”¨ï¼Œå³:</li>
</ul>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Logo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Logo.svg'</span>

<span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨</span>
&#x3C;<span class="hljs-title class_">Logo</span> />
</code></pre>
<ul>
<li>å½“<code>defaultExports</code>ä¸º<code>url</code>ï¼Œé»˜è®¤å½“åš url ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦ç”¨ä½œç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡<code>å…·åå¯¼å…¥</code>çš„æ–¹å¼æ¥æ”¯æŒ:</li>
</ul>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> logoUrl, { <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Logo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./logo.svg'</span>;

<span class="hljs-comment">// url ä½¿ç”¨</span>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{logoUrl}</span> /></span></span>
<span class="hljs-comment">// ç»„ä»¶æ–¹å¼ä½¿ç”¨</span>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Logo</span> /></span></span>
</code></pre>
<p>æ˜ç¡®äº†éœ€æ±‚ä¹‹åï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥æ•´ç†ä¸€ä¸‹æ’ä»¶å¼€å‘çš„æ•´ä½“æ€è·¯ï¼Œä¸»è¦é€»è¾‘åœ¨ <code>transform</code>é’©å­ä¸­å®Œæˆï¼Œæµç¨‹å¦‚ä¸‹:</p>
<ul>
<li>
<ol>
<li>æ ¹æ® id å…¥å‚è¿‡æ»¤å‡º svg èµ„æºï¼›</li>
</ol>
</li>
<li>
<ol start="2">
<li>è¯»å– svg æ–‡ä»¶å†…å®¹ï¼›</li>
</ol>
</li>
<li>
<ol start="3">
<li>åˆ©ç”¨ <code>@svgr/core</code> å°† svg è½¬æ¢ä¸º React ç»„ä»¶ä»£ç ;</li>
</ol>
</li>
<li>
<ol start="4">
<li>å¤„ç†é»˜è®¤å¯¼å‡ºä¸º url çš„æƒ…å†µï¼›</li>
</ol>
</li>
<li>
<ol start="5">
<li>å°†ç»„ä»¶çš„ jsx ä»£ç è½¬è¯‘ä¸ºæµè§ˆå™¨å¯è¿è¡Œçš„ä»£ç ã€‚</li>
</ol>
</li>
</ul>
<p>ä¸‹é¢æ˜¯æ’ä»¶çš„å®Œæ•´çš„ä»£ç ï¼Œä½ å¯ä»¥å‚è€ƒå­¦ä¹ :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Plugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> resolve <span class="hljs-keyword">from</span> <span class="hljs-string">'resolve'</span>;

interface <span class="hljs-title class_">SvgrOptions</span> {
  <span class="hljs-attr">defaultExport</span>: <span class="hljs-string">'url'</span> | <span class="hljs-string">'component'</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">viteSvgrPlugin</span>(<span class="hljs-params">options: SvgrOptions</span>): <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-keyword">const</span> { defaultExport=<span class="hljs-string">'component'</span> } = options;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-svgr'</span>,
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {
      <span class="hljs-comment">// 1. æ ¹æ® id å…¥å‚è¿‡æ»¤å‡º svg èµ„æºï¼›</span>
      <span class="hljs-keyword">if</span> (!id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.svg'</span>)) {
        <span class="hljs-keyword">return</span> code;
      }
      <span class="hljs-keyword">const</span> svgrTransform = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@svgr/core'</span>).<span class="hljs-property">transform</span>;
      <span class="hljs-comment">// è§£æ esbuild çš„è·¯å¾„ï¼Œåç»­è½¬è¯‘ jsx ä¼šç”¨åˆ°ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥æ‹¿ vite ä¸­çš„ esbuild å³å¯</span>
      <span class="hljs-keyword">const</span> esbuildPackagePath = resolve.<span class="hljs-title function_">sync</span>(<span class="hljs-string">'esbuild'</span>, { <span class="hljs-attr">basedir</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'vite'</span>) });
      <span class="hljs-keyword">const</span> esbuild = <span class="hljs-built_in">require</span>(esbuildPackagePath);
      <span class="hljs-comment">// 2. è¯»å– svg æ–‡ä»¶å†…å®¹ï¼›</span>
      <span class="hljs-keyword">const</span> svg = <span class="hljs-keyword">await</span> fs.<span class="hljs-property">promises</span>.<span class="hljs-title function_">readFile</span>(id, <span class="hljs-string">'utf8'</span>);
      <span class="hljs-comment">// 3. åˆ©ç”¨ `@svgr/core` å°† svg è½¬æ¢ä¸º React ç»„ä»¶ä»£ç </span>
      <span class="hljs-keyword">const</span> svgrResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">svgrTransform</span>(
        svg,
        {},
        { <span class="hljs-attr">componentName</span>: <span class="hljs-string">'ReactComponent'</span> }
      );
      <span class="hljs-comment">// 4. å¤„ç†é»˜è®¤å¯¼å‡ºä¸º url çš„æƒ…å†µ</span>
      <span class="hljs-keyword">let</span> componentCode = svgrResult;
      <span class="hljs-keyword">if</span> (defaultExport === <span class="hljs-string">'url'</span>) {
        <span class="hljs-comment">// åŠ ä¸Š Vite é»˜è®¤çš„ `export default èµ„æºè·¯å¾„`</span>
        componentCode += code;
        componentCode = componentCode.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'export default ReactComponent'</span>, <span class="hljs-string">'export { ReactComponent }'</span>);
      }
      <span class="hljs-comment">// 5. åˆ©ç”¨ esbuildï¼Œå°†ç»„ä»¶ä¸­çš„ jsx ä»£ç è½¬è¯‘ä¸ºæµè§ˆå™¨å¯è¿è¡Œçš„ä»£ç ;</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> esbuild.<span class="hljs-title function_">transform</span>(componentCode, {
        <span class="hljs-attr">loader</span>: <span class="hljs-string">'jsx'</span>,
      });
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: result.<span class="hljs-property">code</span>,
        <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span> <span class="hljs-comment">// TODO</span>
      };
    },
  };
}
</code></pre>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªæ’ä»¶:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> svgr <span class="hljs-keyword">from</span> <span class="hljs-string">'./plugins/svgr'</span>;

<span class="hljs-comment">// è¿”å›çš„é…ç½®</span>
{
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// çœç•¥å…¶å®ƒæ’ä»¶</span>
    <span class="hljs-title function_">svgr</span>()
  ]
}
</code></pre>
<p>æ¥ç€æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç”¨ç»„ä»¶çš„æ–¹å¼å¼•å…¥ svg:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// App.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Logo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./logo.svg'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&#x3C;></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">Logo</span> /></span>
    <span class="hljs-tag">&#x3C;/></span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œå¯ä»¥çœ‹åˆ°ç»„ä»¶å·²ç»æ­£å¸¸æ˜¾ç¤º:</p>
<p><img src="img\bb90f6e1-ae61-11ed-8558-342eb7027b95.jpg" alt="image.png"></p>
<h3>è°ƒè¯•æŠ€å·§</h3>
<p>å¦å¤–ï¼Œåœ¨å¼€å‘è°ƒè¯•æ’ä»¶çš„è¿‡ç¨‹ï¼Œæˆ‘æ¨èå¤§å®¶åœ¨æœ¬åœ°è£…ä¸Š<code>vite-plugin-inspect</code>æ’ä»¶ï¼Œå¹¶åœ¨ Vite ä¸­ä½¿ç”¨å®ƒ:</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> inspect <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-inspect'</span>;

<span class="hljs-comment">// è¿”å›çš„é…ç½®</span>
{
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// çœç•¥å…¶å®ƒæ’ä»¶</span>
    <span class="hljs-title function_">inspect</span>()
  ]
}
</code></pre>
<p>è¿™æ ·å½“ä½ å†æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œä¼šå‘ç°å¤šå‡ºä¸€ä¸ªè°ƒè¯•åœ°å€:</p>
<p><img src="img\bba946e9-ae61-11ed-89f2-342eb7027b95.jpg" alt="image.png"></p>
<p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€æ¥æŸ¥çœ‹é¡¹ç›®ä¸­å„ä¸ªæ¨¡å—çš„ç¼–è¯‘ç»“æœï¼š</p>
<p><img src="img\bbc2fe6a-ae61-11ed-94bb-342eb7027b95.jpg" alt="image.png"></p>
<p>ç‚¹å‡»ç‰¹å®šçš„æ–‡ä»¶åï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¨¡å—ç»è¿‡å„ä¸ªæ’ä»¶å¤„ç†åçš„ä¸­é—´ç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="img\bbdcd483-ae61-11ed-87de-342eb7027b95.jpg" alt="image.png"></p>
<p>é€šè¿‡è¿™ä¸ªé¢æ¿ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ç›¸åº”æ¨¡å—ç»è¿‡æ’ä»¶å¤„ç†åå˜æˆäº†ä»€ä¹ˆæ ·å­ï¼Œè®©æ’ä»¶çš„è°ƒè¯•æ›´åŠ æ–¹ä¾¿ã€‚</p>
<h2>å°ç»“</h2>
<p>å¥½ï¼Œæœ¬èŠ‚çš„å†…å®¹åˆ°è¿™é‡Œå°±æ¥è¿‘å°¾å£°äº†ã€‚æœ¬èŠ‚ä½ éœ€è¦é‡ç‚¹æŒæ¡ Vite <strong>æ’ä»¶é’©å­çš„å«ä¹‰</strong>ã€<strong>ä½œç”¨é¡ºåº</strong>ä»¥åŠ<strong>æ’ä»¶çš„å®æˆ˜å¼€å‘</strong>ã€‚</p>
<p>é¦–å…ˆæˆ‘é€šè¿‡ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹è®©ä½ å¯¹ Vite æ’ä»¶çš„ç»“æ„æœ‰äº†åˆæ­¥çš„å°è±¡ï¼Œç„¶åå¯¹ Vite ä¸­çš„å„ç§é’©å­å‡½æ•°è¿›è¡Œäº†ä»‹ç»ï¼Œä¸»è¦åŒ…æ‹¬<code>é€šç”¨é’©å­</code>å’Œ<code>ç‹¬æœ‰é’©å­</code>ï¼Œé€šç”¨é’©å­ä¸ Rollup å…¼å®¹ï¼Œè€Œç‹¬æœ‰é’©å­åœ¨ Rollup ä¸­ä¼šè¢«å¿½ç•¥ã€‚è€Œç”±äºä¸Šä¸€èŠ‚å·²ç»è¯¦ç»†ä»‹ç»äº† Rollup çš„æ’ä»¶æœºåˆ¶ï¼Œå¯¹äºé€šç”¨é’©å­æˆ‘ä»¬æ²¡æœ‰ç»§ç»­å±•å¼€ï¼Œè€Œæ˜¯è¯¦ç»†ä»‹ç»äº† 5 ä¸ªç‹¬æœ‰é’©å­ï¼Œåˆ†åˆ«æ˜¯: <code>config</code>ã€<code>configResolved</code>ã€<code>configureServer</code>ã€<code>transformIndexHtml</code>å’Œ<code>handleHotUpdate</code>ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘è¿˜ç»™ä½ ä»å®è§‚è§’åº¦åˆ†æäº† Vite æ’ä»¶çš„ä½œç”¨åœºæ™¯å’Œä½œç”¨é¡ºåºï¼Œä½ å¯ä»¥åˆ†åˆ«é€šè¿‡<code>apply</code>å’Œ<code>enforce</code>ä¸¤ä¸ªå‚æ•°æ¥è¿›è¡Œæ‰‹åŠ¨çš„æ§åˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼è¿›å…¥æ’ä»¶å¼€å‘å®æˆ˜çš„ç¯èŠ‚ï¼Œå®ç°äº†<code>è™šæ‹Ÿæ¨¡å—åŠ è½½æ’ä»¶</code>å’Œ<code>Svg ç»„ä»¶åŠ è½½æ’ä»¶</code>ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹è™šæ‹Ÿæ¨¡å—çš„æ¦‚å¿µå’Œä½¿ç”¨æœ‰äº†ç›´è§‚çš„äº†è§£ï¼Œä¹Ÿèƒ½é€šè¿‡åè€…çš„å¼€å‘è¿‡ç¨‹äº†è§£åˆ°å¦‚ä½•åœ¨ Vite ä¸­é›†æˆå…¶å®ƒçš„å‰ç«¯ç¼–è¯‘å·¥å…·ã€‚æ€»ä½“æ¥è¯´ï¼ŒVite  æ’ä»¶çš„è®¾è®¡ç§‰æ‰¿äº† Rollup çš„æ’ä»¶è®¾è®¡ç†å¿µï¼Œé€šè¿‡ä¸€ä¸ªä¸ªè¯­ä¹‰åŒ–çš„ Hook æ¥ç»„ç»‡ï¼Œååˆ†ç®€æ´å’Œçµæ´»ï¼Œä¸Šæ‰‹éš¾åº¦å¹¶ä¸å¤§ï¼Œä½†çœŸæ­£éš¾çš„åœ°æ–¹åœ¨äºå¦‚ä½•åˆ©ç”¨ Vite æ’ä»¶å»è§£å†³å®é™…å¼€å‘è¿‡ç¨‹çš„é—®é¢˜ï¼Œç”±äºç¯‡å¹…æ‰€é™ï¼Œæœ¬æ–‡çš„ç¤ºä¾‹å¹¶ä¸èƒ½è¦†ç›–æ‰€æœ‰çš„å¼€å‘åœºæ™¯ï¼Œä½ ä¹Ÿä¸å¿…ç€æ€¥ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„å‡ ä¸ªå°èŠ‚ä¸­æ¥è§¦åˆ°æ›´åŠ é«˜çº§çš„å¼€å‘åœºæ™¯ï¼Œä½ ä¹Ÿå°†æ¥è§¦è¿‡è¶Šæ¥è¶Šå¤šçš„æ’ä»¶ï¼Œå½“ç„¶ï¼Œä½ çš„æ’ä»¶å¼€å‘æŠ€èƒ½ä¹Ÿèƒ½è¶Šæ¥è¶Šçº¯ç†Ÿã€‚å¤§å®¶ç»§ç»­åŠ æ²¹ğŸ’ªğŸ»ï¼</p>
</div>
</body>
</html>